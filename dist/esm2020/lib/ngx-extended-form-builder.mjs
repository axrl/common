import { FormGroup, FormArray, FormControl } from "@angular/forms";
import { Observable } from "rxjs";
function getValidatorsOrNull(key, options, addLift = false) {
    const result = options && options.has(key) ? options.get(key) : null;
    if (addLift) {
        if (result && result.validators) {
            result.validators.push(liftErrors);
            return result;
        }
        else {
            if (result) {
                result.validators = [liftErrors];
                return result;
            }
            else {
                return {
                    validators: [liftErrors]
                };
            }
            ;
        }
    }
    else {
        return result;
    }
    ;
}
function makeNewMainMap(key, oldMap) {
    if (!oldMap || key === 'main') {
        return oldMap;
    }
    else {
        if (!oldMap.has(key) && !oldMap.has(`${key}Items`)) {
            return new Map(Array.from(oldMap.entries()).filter(item => item[0] !== 'main' && item[0] !== 'mainItems').map(([entryKey, entryValue]) => [(entryKey.startsWith(`${key}.`) ? entryKey.replace(`${key}.`, '') : entryKey), entryValue]));
        }
        else {
            const filterPredicate = oldMap.has('main') ?
                oldMap.has('mainItems') ?
                    (item) => {
                        const pre = item[0] !== (key + 'Items');
                        return item[0] !== key && pre && item[0] !== 'main' && item[0] !== 'mainItems';
                    } :
                    (item) => {
                        const pre = item[0] !== (key + 'Items');
                        return item[0] !== key && key[0] !== (key + 'Items') && item[0] !== 'main';
                    } :
                oldMap.has('mainItems') ?
                    (item) => {
                        const pre = item[0] !== (key + 'Items');
                        return item[0] !== key && pre && item[0] !== 'mainItems';
                    } :
                    (item) => {
                        const pre = item[0] !== (key + 'Items');
                        return item[0] !== key && pre;
                    };
            const newMainValidatorsArray = oldMap.has(key) ?
                oldMap.has(`${key}Items`) ?
                    [
                        ['main', oldMap.get(key)],
                        ['mainItems', oldMap.get(`${key}Items`)]
                    ] :
                    [
                        ['main', oldMap.get(key)],
                    ] :
                oldMap.has(`${key}Items`) ?
                    [
                        ['mainItems', oldMap.get(`${key}Items`)]
                    ] :
                    [];
            const filtered = Array.from(oldMap.entries()).filter(filterPredicate);
            const result = new Map([
                ...newMainValidatorsArray,
                ...filtered.map(([entryKey, entryValue]) => [(entryKey.startsWith(`${key}.`) ?
                        entryKey.replace(`${key}.`, '') :
                        entryKey.startsWith(`${key}Items.`) ?
                            entryKey.replace(`${key}Items.`, '') :
                            entryKey), entryValue])
            ]);
            console.log(key, oldMap, filtered, result);
            return result;
        }
        ;
    }
    ;
}
/**
@function makeForm<T>
  Фабричная функция для создания Angular Reactive Form.
В отличие от стандартного FormBuilder - а в пакете @angular/forms, при создании формы из сложных объектов,
сохраняется вложенность контролов - каждый вложенный объект превращается во вложенную FormGroup,
  обычные свойства объектов становятся FormControl - ами, а массивы - FormArray - ми.
При этом создаваемая форма имеет более строгую типизацию.

  ВАЖНО!
   Чтобы избежать ошибки переполнения стэка вызовов в рекурсивном процессе создания формы, для любых;
Observable - значений(в т.ч., к примеру, Subject * и EventEmitter) соответствующий элемент формы не создается.
 * @param source  источник данных типа T для создания формы.
 * @param keysValidator объект Map с конфигурацией синхронных валидаторов контролов формы.
 * В качестве ключей могут быть указаны следующие значения:
 *  PropertyesKeys<T> - строковые ключи в типе T, включая строковые ключи всех вложенных типов, разделенные "." - точкой.
    Например имеется такой тип:
    ```ts
                    interface User {
                      firstname: string;
                      lastname: string;
                      phone:  {
                        code: string;
                        number: string;
                        }
                      };
    ```
    Для формы, которая будет создана из объекта User в конфигурации валидаторов названия контролов можно будет указать так:
    `lastname` или`phone`, или`phone.code`.

   'main' - специальное значение, являющееся признаком того, что массив валидаторов необходимо
    назначить самому объекту формы, а не вложеным контролам.

   'mainItems' - используется только если source является массивом. Специальное значение, являющееся признаком того,
  что массив валидаторов необходимо назначить для всех элементов массива FormArray.
 * @param asyncKeysValidator объект Map, аналогичный keysValidator, но для асинхронных валидаторов
 * @returns объект типизированной формы - FormGroup, FormArray или FormControl в зависимости от типа значения source.
 */
export function makeForm(source, options) {
    const form = !!source && (typeof source === 'object' || typeof source === 'function') ?
        source instanceof (Array) ?
            makeArray(source, options) :
            makeGroup(source, 'main', options) :
        makeControl(source, options);
    return form;
}
;
function liftErrors(control) {
    if (control instanceof FormControl) {
        return null;
    }
    else {
        const allControls = control instanceof FormGroup ?
            Object.values(control.controls) :
            control instanceof FormArray ?
                control.controls :
                [];
        const invalidControls = allControls.filter(control => control.status === 'INVALID');
        return invalidControls.length === 0 ? null : invalidControls.reduce((accumulator, current) => {
            if (current.errors) {
                addValidationErrors(current.errors, accumulator);
            }
            ;
            return accumulator;
        }, {});
    }
}
export function liftValidationErrors(control) {
    const allControls = control instanceof FormGroup ?
        Object.values(control.controls) :
        control instanceof FormArray ?
            control.controls :
            [];
    const invalidControls = allControls.filter(control => control.status === 'INVALID');
    const errors = invalidControls.length === 0 ? {} : invalidControls.reduce((accumulator, current) => {
        if (current.errors) {
            addValidationErrors(current.errors, accumulator);
        }
        ;
        const innerErrors = liftValidationErrors(current);
        if (innerErrors) {
            addValidationErrors(innerErrors, accumulator);
        }
        ;
        return accumulator;
    }, {});
    return Object.values(errors).length === 0 ? null : errors;
}
;
function addValidationErrors(additionErrors, currentErrors) {
    Object.entries(additionErrors).forEach(entry => currentErrors[entry[0]] = entry[1]);
}
function makeControl(source, options) {
    const controlOptions = getValidatorsOrNull('main', options, false);
    const result = source instanceof FormControl ?
        source :
        new FormControl(!!source && typeof source == 'string' && (source.includes('0001-01-01') || source.includes('1970-01-01')) ? null : source, {
            validators: controlOptions?.validators,
            asyncValidators: controlOptions?.asyncValidators,
            updateOn: controlOptions?.updateOn,
            nonNullable: controlOptions?.nonNullable
        });
    if (controlOptions?.disabled) {
        result.disable();
    }
    ;
    return result;
}
function makeGroup(source, internalKey, options) {
    const controlOptions = getValidatorsOrNull(internalKey, options, false);
    const result = source instanceof (FormGroup) ?
        source :
        Object.entries(source).reduce((accumulator, entry) => {
            const key = entry[0];
            const value = entry[1];
            if (!(value instanceof Observable)) {
                accumulator.addControl(key, !!value && (value instanceof FormGroup || value instanceof FormArray || value instanceof FormControl) ?
                    value :
                    makeForm(value, makeNewMainMap(key, options)));
            }
            ;
            return accumulator;
        }, new FormGroup({}, {
            validators: controlOptions?.validators,
            asyncValidators: controlOptions?.asyncValidators,
            updateOn: controlOptions?.updateOn,
        }));
    if (controlOptions?.disabled) {
        result.disable();
    }
    ;
    return result;
}
function makeArray(source, options) {
    const controlOptions = getValidatorsOrNull('main', options, false);
    const result = source instanceof FormArray ?
        source :
        new FormArray(source.map((item) => {
            const itemForm = makeForm(item, makeNewMainMap('mainItems', options));
            return itemForm;
        }), {
            validators: controlOptions?.validators,
            asyncValidators: controlOptions?.asyncValidators,
            updateOn: controlOptions?.updateOn
        });
    if (controlOptions?.disabled) {
        result.disable();
    }
    ;
    return result;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWV4dGVuZGVkLWZvcm0tYnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Byb2plY3RzL25neC1leHRlbmRlZC1mb3JtLWJ1aWxkZXIvc3JjL2xpYi9uZ3gtZXh0ZW5kZWQtZm9ybS1idWlsZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRW5FLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFzRWxDLFNBQVMsbUJBQW1CLENBQzFCLEdBQXFCLEVBQ3JCLE9BQW1ELEVBQ25ELFVBQW1CLEtBQUs7SUFFeEIsTUFBTSxNQUFNLEdBQUcsT0FBTyxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNyRSxJQUFJLE9BQU8sRUFBRTtRQUNYLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxVQUFVLEVBQUU7WUFDL0IsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQWUsVUFBVSxDQUFDLENBQUM7WUFDakQsT0FBTyxNQUFNLENBQUM7U0FDZjthQUFNO1lBQ0wsSUFBSSxNQUFNLEVBQUU7Z0JBQ1YsTUFBTSxDQUFDLFVBQVUsR0FBRyxDQUFFLFVBQVUsQ0FBRSxDQUFDO2dCQUNuQyxPQUFPLE1BQU0sQ0FBQzthQUNmO2lCQUFNO2dCQUNMLE9BQU87b0JBQ0wsVUFBVSxFQUFFLENBQUUsVUFBVSxDQUFFO2lCQUMzQixDQUFDO2FBQ0g7WUFBQSxDQUFDO1NBQ0g7S0FDRjtTQUFNO1FBQ0wsT0FBTyxNQUFNLENBQUM7S0FDZjtJQUFBLENBQUM7QUFDSixDQUFDO0FBRUQsU0FBUyxjQUFjLENBQ3JCLEdBQXFCLEVBQ3JCLE1BQWtEO0lBRWxELElBQUks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QWMsRUFBRSxVQUFVO1lBQ3RDLGVBQWUsRUFBRSxjQUFjLEVBQUUsZUFBZTtZQUNoRCxRQUFRLEVBQUUsY0FBYyxFQUFFLFFBQVE7U0FDbkMsQ0FDRixDQUNGLENBQUM7SUFDSixJQUFJLGNBQWMsRUFBRSxRQUFRLEVBQUU7UUFDNUIsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO0tBQ2xCO0lBQUEsQ0FBQztJQUNGLE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFFRCxTQUFTLFNBQVMsQ0FDaEIsTUFBd0MsRUFDeEMsT0FBbUQ7SUFFbkQsTUFBTSxjQUFjLEdBQUcsbUJBQW1CLENBQW9CLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDdEYsTUFBTSxNQUFNLEdBQUcsTUFBTSxZQUFZLFNBQVMsQ0FBQyxDQUFDO1FBQzFDLE1BQU0sQ0FBQyxDQUFDO1FBQ1IsSUFBSSxTQUFTLENBQ1gsTUFBTSxDQUFDLEdBQUcsQ0FDUixDQUFDLElBQU8sRUFBRSxFQUFFO1lBQ1YsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUN2QixJQUFJLEVBQ0osY0FBYyxDQUEwQixXQUFXLEVBQUUsT0FBTyxDQUFDLENBQzlELENBQUM7WUFDRixPQUFPLFFBQVEsQ0FBQztRQUNsQixDQUFDLENBQUMsRUFDSjtZQUNFLFVBQVUsRUFBRSxjQUFjLEVBQUUsVUFBVTtZQUN0QyxlQUFlLEVBQUUsY0FBYyxFQUFFLGVBQWU7WUFDaEQsUUFBUSxFQUFFLGNBQWMsRUFBRSxRQUFRO1NBQ25DLENBQ0YsQ0FBQztJQUNKLElBQUksY0FBYyxFQUFFLFFBQVEsRUFBRTtRQUM1QixNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7S0FDbEI7SUFBQSxDQUFDO0lBQ0YsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZvcm1Hcm91cCwgRm9ybUFycmF5LCBGb3JtQ29udHJvbCB9IGZyb20gXCJAYW5ndWxhci9mb3Jtc1wiO1xuaW1wb3J0IHR5cGUgeyBWYWxpZGF0b3JGbiwgVmFsaWRhdGlvbkVycm9ycywgQXN5bmNWYWxpZGF0b3JGbiwgQWJzdHJhY3RDb250cm9sLCBGb3JtQ29udHJvbE9wdGlvbnMgfSBmcm9tIFwiQGFuZ3VsYXIvZm9ybXNcIjtcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tIFwicnhqc1wiO1xuXG4vKipcbiAqINCS0YHQv9C+0LzQvtCz0LDRgtC10LvRjNC90LDRjyDRg9GC0LjQu9C40YLQsCDRgtC40L/QsC5cbiAqINCd0LAg0LLRhdC+0LQg0L/RgNC40L3QuNC80LDQtdGCINC90LXQutC40Lkg0YLQuNC/IFQsINCy0L7Qt9Cy0YDQsNGJ0LDQtdGCINGB0L/QuNGB0L7QuiDRgtC+0LvRjNC60L4g0YHRgtGA0L7QutC+0LLRi9GFINC60LvRjtGH0LXQuSDRjdGC0L7Qs9C+INGC0LjQv9CwLCDQv9GA0Lgg0Y3RgtC+0Lwg0LfQvdCw0YfQtdC90LjRjyDRjdGC0LjRhSDQutC70Y7Rh9C10Lkg0L3QtSDRj9Cy0LvRj9GO0YLRgdGPIE9ic2VydmFibGUuXG4gKi9cbmV4cG9ydCB0eXBlIFN0cmluZ0tleXM8VD4gPSB7XG4gIFsgSyBpbiBrZXlvZiBUIF06IFRbIEsgXSBleHRlbmRzIE9ic2VydmFibGU8dW5rbm93bj4gP1xuICBuZXZlciA6XG4gIEsgZXh0ZW5kcyBzdHJpbmcgP1xuICBLIDogbmV2ZXI7XG59WyBrZXlvZiBUIF07XG5cbi8qKlxuICog0JLRgdC/0L7QvNC+0LPQsNGC0LXQu9GM0L3Ri9C5IGFsaWFzLdGC0LjQvyDQutC70Y7Rh9C10Lkg0LIg0L7QsdGK0LXQutGC0LUgTWFwLCDRgdC+0LTQtdGA0LbQsNGJ0LXQvCDQutC+0L3RhNC40LPRg9GA0LDRhtC40Y4g0LLQsNC70LjQtNCw0YLQvtGA0L7QsiDQutC+0L3RgtGA0L7Qu9C+0LIuXG4gKi9cbmV4cG9ydCB0eXBlIENvbnRyb2xzTmFtZXM8VD4gPSBUIGV4dGVuZHMgT2JzZXJ2YWJsZTx1bmtub3duPiA/XG4gIG5ldmVyIDpcbiAgVCBleHRlbmRzIEFycmF5PGluZmVyIFU+ID9cbiAgJ21haW4nIHwgJ21haW5JdGVtcycgfCBgbWFpbkl0ZW1zLiR7IFByb3BlcnR5ZXNLZXlzPFU+IH1gIDpcbiAgJ21haW4nIHwgUHJvcGVydHllc0tleXM8VD47XG4vKipcbiAqINCS0YHQv9C+0LzQvtCz0LDRgtC10LvRjNC90LDRjyDRg9GC0LjQu9C40YLQsCDRgtC40L/QsC5cbiAqINCd0LAg0LLRhdC+0LQg0L/RgNC40L3QuNC80LDQtdGCINC90LXQutC40Lkg0YLQuNC/IFQsINCy0L7Qt9Cy0YDQsNGJ0LDQtdGCINGC0L7Qu9GM0LrQviDRgdGC0YDQvtC60L7QstGL0LUg0LrQu9GO0YfQuCDRjdGC0L7Qs9C+INGC0LjQv9CwLlxuICovXG5leHBvcnQgdHlwZSBQcm9wZXJ0eWVzS2V5czxUPiA9IFQgZXh0ZW5kcyB1bmRlZmluZWQgfCBudWxsIHwgbnVtYmVyIHwgYm9vbGVhbiB8IHN5bWJvbCB8IE9ic2VydmFibGU8dW5rbm93bj4gP1xuICBuZXZlciA6XG4gIFQgZXh0ZW5kcyBzdHJpbmcgP1xuICBUIDpcbiAgVCBleHRlbmRzIEFycmF5PGluZmVyIFU+ID9cbiAgUHJvcGVydHllc0tleXM8VT4gOlxuICB7XG4gICAgWyBLIGluIGtleW9mIFQgXS0/OiBLIGV4dGVuZHMgc3RyaW5nID9cbiAgICBUWyBLIF0gZXh0ZW5kcyAoc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbiB8IHN5bWJvbCB8IHVuZGVmaW5lZCB8IG51bGwpID9cbiAgICBLIDpcbiAgICBUWyBLIF0gZXh0ZW5kcyBPYnNlcnZhYmxlPHVua25vd24+ID9cbiAgICBuZXZlciA6XG4gICAgVFsgSyBdIGV4dGVuZHMgQXJyYXk8aW5mZXIgVT4gP1xuICAgIGAkeyBLIH1JdGVtcy4keyBQcm9wZXJ0eWVzS2V5czxVPiB9YCB8IGAkeyBLIH1JdGVtc2AgfCBLIDpcbiAgICBgJHsgSyB9LiR7IFByb3BlcnR5ZXNLZXlzPFRbIEsgXT4gfWAgfCBLIDogbmV2ZXJcbiAgfVsga2V5b2YgVCBdO1xuLyoqXG4gKiDQo9C/0YDQvtGJ0LXQvdC90LDRjyDQt9Cw0L/QuNGB0Ywg0LTQu9GPINGC0LjQv9CwINC+0LHRitC10LrRgtCwIEZvcm1Hcm91cCwg0L7QsdGA0LDQt9C+0LLQsNC90L3QvtCz0L4g0LjQtyDRgtC40L/QsCBULlxuICovXG5leHBvcnQgdHlwZSBGb3JtR3JvdXBUeXBlPFQ+ID0gRm9ybUdyb3VwPHsgWyBLIGluIFN0cmluZ0tleXM8VD4gXTogU2NhbkZvcm1UeXBlPFRbIEsgXT47IH0+O1xuXG4vKipcbiAqINCj0L3QuNCy0LXRgNGB0LDQu9GM0L3Ri9C5INGC0LjQvy3Rg9GC0LjQu9C40YLQsC5cbiAqINCU0LvRjyDQu9GO0LHQvtCz0L4g0YLQuNC/0LAg0KIg0LLRi9Cy0L7QtNC40YIg0L/RgNCw0LLQuNC70YzQvdGL0Lkg0YLQuNC/INGB0L7Qt9C00LDQstCw0LXQvNC+0Lkg0YTQvtGA0LzRiywg0LLQutC70Y7Rh9Cw0Y8g0LvRjtCx0L7QuSDRg9GA0L7QstC10L3RjCDQstC70L7QttC10L3QvdC+0YHRgtC4LlxuICog0JLQkNCW0J3QniFcbiAqINCn0YLQvtCx0Ysg0LjQt9Cx0LXQttCw0YLRjCDQvtGI0LjQsdC60Lgg0L/QtdGA0LXQv9C+0LvQvdC10L3QuNGPINGB0YLRjdC60LAg0LLRi9C30L7QstC+0LIg0LIg0YDQtdC60YPRgNGB0LjQstC90L7QvCDQv9GA0L7RhtC10YHRgdC1INGB0L7Qt9C00LDQvdC40Y8g0YTQvtGA0LzRiywg0LTQu9GPINC70Y7QsdGL0YVcbiAqIE9ic2VydmFibGUt0LfQvdCw0YfQtdC90LjQuSAoINCyINGCLtGHLiwg0Log0L/RgNC40LzQtdGA0YMsIFN1YmplY3QgICog0LggRXZlbnRFbWl0dGVyKSDRgdC+0L7RgtCy0LXRgtGB0YLQstGD0Y7RidC40Lkg0Y3Qu9C10LzQtdC90YIg0YTQvtGA0LzRiyDQvdC1INGB0L7Qt9C00LDQtdGC0YHRjy5cbiAqIFNjYW5Gb3JtVHlwZSDRjdGC0L4g0YLQsNC60LbQtSDRg9GH0LjRgtGL0LLQsNC10YIuXG4gKi9cbmV4cG9ydCB0eXBlIFNjYW5Gb3JtVHlwZTxUPiA9IFQgZXh0ZW5kcyBBYnN0cmFjdENvbnRyb2w8dW5rbm93biwgdW5rbm93bj4gP1xuICBUIDpcbiAgVCBleHRlbmRzIG51bGwgfCB1bmRlZmluZWQgP1xuICBuZXZlciA6XG4gIFQgZXh0ZW5kcyBBcnJheTxpbmZlciBVPiA/XG4gIEZvcm1BcnJheTxTY2FuRm9ybVR5cGU8VT4+IDpcbiAgVCBleHRlbmRzIChzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgc3ltYm9sIHwgbnVsbCB8IHVuZGVmaW5lZCkgP1xuICBGb3JtQ29udHJvbDxUPiA6XG4gIEZvcm1Hcm91cFR5cGU8VD47XG5cbnR5cGUgTWFrZUNvbnRyb2xPcHRpb25zID0gT21pdDxGb3JtQ29udHJvbE9wdGlvbnMsICd2YWxpZGF0b3JzJyB8ICdhc3luY1ZhbGlkYXRvcnMnPiAmIHtcbiAgZGlzYWJsZWQ/OiBib29sZWFuO1xuICB2YWxpZGF0b3JzPzogVmFsaWRhdG9yRm5bXTtcbiAgYXN5bmNWYWxpZGF0b3JzPzogQXN5bmNWYWxpZGF0b3JGbltdO1xufTtcblxuZnVuY3Rpb24gZ2V0VmFsaWRhdG9yc09yTnVsbDxUPihcbiAga2V5OiBDb250cm9sc05hbWVzPFQ+LFxuICBvcHRpb25zPzogTWFwPENvbnRyb2xzTmFtZXM8VD4sIE1ha2VDb250cm9sT3B0aW9ucz4sXG4gIGFkZExpZnQ6IGJvb2xlYW4gPSBmYWxzZVxuKTogTWFrZUNvbnRyb2xPcHRpb25zIHwgbnVsbCB8IHVuZGVmaW5lZCB7XG4gIGNvbnN0IHJlc3VsdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5oYXMoa2V5KSA/IG9wdGlvbnMuZ2V0KGtleSkgOiBudWxsO1xuICBpZiAoYWRkTGlmdCkge1xuICAgIGlmIChyZXN1bHQgJiYgcmVzdWx0LnZhbGlkYXRvcnMpIHtcbiAgICAgIHJlc3VsdC52YWxpZGF0b3JzLnB1c2goPFZhbGlkYXRvckZuPiBsaWZ0RXJyb3JzKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgcmVzdWx0LnZhbGlkYXRvcnMgPSBbIGxpZnRFcnJvcnMgXTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdmFsaWRhdG9yczogWyBsaWZ0RXJyb3JzIF1cbiAgICAgICAgfTtcbiAgICAgIH07XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG59XG5cbmZ1bmN0aW9uIG1ha2VOZXdNYWluTWFwPEksIE8+KFxuICBrZXk6IENvbnRyb2xzTmFtZXM8ST4sXG4gIG9sZE1hcD86IE1hcDxDb250cm9sc05hbWVzPEk+LCBNYWtlQ29udHJvbE9wdGlvbnM+LFxuKTogTWFwPENvbnRyb2xzTmFtZXM8Tz4sIE1ha2VDb250cm9sT3B0aW9ucz4gfCB1bmRlZmluZWQge1xuICBpZiAoIW9sZE1hcCB8fCBrZXkgPT09ICdtYWluJykge1xuICAgIHJldHVybiA8TWFwPENvbnRyb2xzTmFtZXM8Tz4sIE1ha2VDb250cm9sT3B0aW9ucz4gfCB1bmRlZmluZWQ+IG9sZE1hcDtcbiAgfSBlbHNlIHtcbiAgICBpZiAoIW9sZE1hcC5oYXMoa2V5KSAmJiAhb2xkTWFwLmhhcyg8Q29udHJvbHNOYW1lczxJPj4gYCR7IGtleSB9SXRlbXNgKSkge1xuICAgICAgcmV0dXJuIG5ldyBNYXA8Q29udHJvbHNOYW1lczxPPiwgTWFrZUNvbnRyb2xPcHRpb25zPihcbiAgICAgICAgQXJyYXkuZnJvbShcbiAgICAgICAgICBvbGRNYXAuZW50cmllcygpXG4gICAgICAgICkuZmlsdGVyKFxuICAgICAgICAgIGl0ZW0gPT4gaXRlbVsgMCBdICE9PSAnbWFpbicgJiYgaXRlbVsgMCBdICE9PSAnbWFpbkl0ZW1zJ1xuICAgICAgICApLm1hcChcbiAgICAgICAgICAoWyBlbnRyeUtleSwgZW50cnlWYWx1ZSBdKSA9PiBbIDxDb250cm9sc05hbWVzPE8+PihlbnRyeUtleS5zdGFydHNXaXRoKGAkeyBrZXkgfS5gKSA/IGVudHJ5S2V5LnJlcGxhY2UoYCR7IGtleSB9LmAsICcnKSA6IGVudHJ5S2V5KSwgZW50cnlWYWx1ZSBdXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGZpbHRlclByZWRpY2F0ZSA9IG9sZE1hcC5oYXMoPENvbnRyb2xzTmFtZXM8ST4+ICdtYWluJykgP1xuICAgICAgICBvbGRNYXAuaGFzKDxDb250cm9sc05hbWVzPEk+PiAnbWFpbkl0ZW1zJykgP1xuICAgICAgICAgIChpdGVtOiBbIENvbnRyb2xzTmFtZXM8ST4sIE1ha2VDb250cm9sT3B0aW9ucyBdKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBwcmUgPSBpdGVtWyAwIF0gIT09IChrZXkgKyAnSXRlbXMnKTtcbiAgICAgICAgICAgIHJldHVybiBpdGVtWyAwIF0gIT09IGtleSAmJiBwcmUgJiYgaXRlbVsgMCBdICE9PSAnbWFpbicgJiYgaXRlbVsgMCBdICE9PSAnbWFpbkl0ZW1zJztcbiAgICAgICAgICB9IDpcbiAgICAgICAgICAoaXRlbTogWyBDb250cm9sc05hbWVzPEk+LCBNYWtlQ29udHJvbE9wdGlvbnMgXSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcHJlID0gaXRlbVsgMCBdICE9PSAoa2V5ICsgJ0l0ZW1zJyk7XG4gICAgICAgICAgICByZXR1cm4gaXRlbVsgMCBdICE9PSBrZXkgJiYga2V5WyAwIF0gIT09IChrZXkgKyAnSXRlbXMnKSAmJiBpdGVtWyAwIF0gIT09ICdtYWluJztcbiAgICAgICAgICB9IDpcbiAgICAgICAgb2xkTWFwLmhhcyg8Q29udHJvbHNOYW1lczxJPj4gJ21haW5JdGVtcycpID9cbiAgICAgICAgICAoaXRlbTogWyBDb250cm9sc05hbWVzPEk+LCBNYWtlQ29udHJvbE9wdGlvbnMgXSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcHJlID0gaXRlbVsgMCBdICE9PSAoa2V5ICsgJ0l0ZW1zJyk7XG4gICAgICAgICAgICByZXR1cm4gaXRlbVsgMCBdICE9PSBrZXkgJiYgcHJlICYmIGl0ZW1bIDAgXSAhPT0gJ21haW5JdGVtcyc7XG4gICAgICAgICAgfSA6XG4gICAgICAgICAgKGl0ZW06IFsgQ29udHJvbHNOYW1lczxJPiwgTWFrZUNvbnRyb2xPcHRpb25zIF0pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHByZSA9IGl0ZW1bIDAgXSAhPT0gKGtleSArICdJdGVtcycpO1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW1bIDAgXSAhPT0ga2V5ICYmIHByZTtcbiAgICAgICAgICB9O1xuICAgICAgY29uc3QgbmV3TWFpblZhbGlkYXRvcnNBcnJheTogWyBDb250cm9sc05hbWVzPE8+LCBNYWtlQ29udHJvbE9wdGlvbnMgXVtdID0gb2xkTWFwLmhhcyhrZXkpID9cbiAgICAgICAgb2xkTWFwLmhhcyg8Q29udHJvbHNOYW1lczxJPj4gYCR7IGtleSB9SXRlbXNgKSA/XG4gICAgICAgICAgW1xuICAgICAgICAgICAgWyA8Q29udHJvbHNOYW1lczxPPj4gJ21haW4nLCBvbGRNYXAuZ2V0KGtleSkhIF0sXG4gICAgICAgICAgICBbIDxDb250cm9sc05hbWVzPE8+PiAnbWFpbkl0ZW1zJywgb2xkTWFwLmdldCg8Q29udHJvbHNOYW1lczxJPj4gYCR7IGtleSB9SXRlbXNgKSEgXVxuICAgICAgICAgIF0gOlxuICAgICAgICAgIFtcbiAgICAgICAgICAgIFsgPENvbnRyb2xzTmFtZXM8Tz4+ICdtYWluJywgb2xkTWFwLmdldChrZXkpISBdLFxuICAgICAgICAgIF0gOlxuICAgICAgICBvbGRNYXAuaGFzKDxDb250cm9sc05hbWVzPEk+PiBgJHsga2V5IH1JdGVtc2ApID9cbiAgICAgICAgICBbXG4gICAgICAgICAgICBbIDxDb250cm9sc05hbWVzPE8+PiAnbWFpbkl0ZW1zJywgb2xkTWFwLmdldCg8Q29udHJvbHNOYW1lczxJPj4gYCR7IGtleSB9SXRlbXNgKSEgXVxuICAgICAgICAgIF0gOlxuICAgICAgICAgIFtdO1xuICAgICAgY29uc3QgZmlsdGVyZWQgPSBBcnJheS5mcm9tKFxuICAgICAgICBvbGRNYXAuZW50cmllcygpXG4gICAgICApLmZpbHRlcihmaWx0ZXJQcmVkaWNhdGUpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gbmV3IE1hcDxDb250cm9sc05hbWVzPE8+LCBNYWtlQ29udHJvbE9wdGlvbnM+KFtcbiAgICAgICAgLi4ubmV3TWFpblZhbGlkYXRvcnNBcnJheSxcbiAgICAgICAgLi4uZmlsdGVyZWQubWFwPFsgQ29udHJvbHNOYW1lczxPPiwgTWFrZUNvbnRyb2xPcHRpb25zIF0+KFxuICAgICAgICAgIChbIGVudHJ5S2V5LCBlbnRyeVZhbHVlIF0pID0+IFsgPENvbnRyb2xzTmFtZXM8Tz4+KFxuICAgICAgICAgICAgZW50cnlLZXkuc3RhcnRzV2l0aChgJHsga2V5IH0uYCkgP1xuICAgICAgICAgICAgICBlbnRyeUtleS5yZXBsYWNlKGAkeyBrZXkgfS5gLCAnJykgOlxuICAgICAgICAgICAgICBlbnRyeUtleS5zdGFydHNXaXRoKGAkeyBrZXkgfUl0ZW1zLmApID9cbiAgICAgICAgICAgICAgICBlbnRyeUtleS5yZXBsYWNlKGAkeyBrZXkgfUl0ZW1zLmAsICcnKSA6XG4gICAgICAgICAgICAgICAgZW50cnlLZXlcbiAgICAgICAgICApLCBlbnRyeVZhbHVlIF1cbiAgICAgICAgKVxuICAgICAgXSk7XG4gICAgICBjb25zb2xlLmxvZyhrZXksIG9sZE1hcCwgZmlsdGVyZWQsIHJlc3VsdCk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gIH07XG59XG5cbi8qKlxuQGZ1bmN0aW9uIG1ha2VGb3JtPFQ+XG4gINCk0LDQsdGA0LjRh9C90LDRjyDRhNGD0L3QutGG0LjRjyDQtNC70Y8g0YHQvtC30LTQsNC90LjRjyBBbmd1bGFyIFJlYWN0aXZlIEZvcm0uXG7QkiDQvtGC0LvQuNGH0LjQtSDQvtGCINGB0YLQsNC90LTQsNGA0YLQvdC+0LPQviBGb3JtQnVpbGRlciAtINCwINCyINC/0LDQutC10YLQtSBAYW5ndWxhci9mb3Jtcywg0L/RgNC4INGB0L7Qt9C00LDQvdC40Lgg0YTQvtGA0LzRiyDQuNC3INGB0LvQvtC20L3Ri9GFINC+0LHRitC10LrRgtC+0LIsXG7RgdC+0YXRgNCw0L3Rj9C10YLRgdGPINCy0LvQvtC20LXQvdC90L7RgdGC0Ywg0LrQvtC90YLRgNC+0LvQvtCyIC0g0LrQsNC20LTRi9C5INCy0LvQvtC20LXQvdC90YvQuSDQvtCx0YrQtdC60YIg0L/RgNC10LLRgNCw0YnQsNC10YLRgdGPINCy0L4g0LLQu9C+0LbQtdC90L3Rg9GOIEZvcm1Hcm91cCxcbiAg0L7QsdGL0YfQvdGL0LUg0YHQstC+0LnRgdGC0LLQsCDQvtCx0YrQtdC60YLQvtCyINGB0YLQsNC90L7QstGP0YLRgdGPIEZvcm1Db250cm9sIC0g0LDQvNC4LCDQsCDQvNCw0YHRgdC40LLRiyAtIEZvcm1BcnJheSAtINC80LguXG7Qn9GA0Lgg0Y3RgtC+0Lwg0YHQvtC30LTQsNCy0LDQtdC80LDRjyDRhNC+0YDQvNCwINC40LzQtdC10YIg0LHQvtC70LXQtSDRgdGC0YDQvtCz0YPRjiDRgtC40L/QuNC30LDRhtC40Y4uXG5cbiAg0JLQkNCW0J3QniFcbiAgINCn0YLQvtCx0Ysg0LjQt9Cx0LXQttCw0YLRjCDQvtGI0LjQsdC60Lgg0L/QtdGA0LXQv9C+0LvQvdC10L3QuNGPINGB0YLRjdC60LAg0LLRi9C30L7QstC+0LIg0LIg0YDQtdC60YPRgNGB0LjQstC90L7QvCDQv9GA0L7RhtC10YHRgdC1INGB0L7Qt9C00LDQvdC40Y8g0YTQvtGA0LzRiywg0LTQu9GPINC70Y7QsdGL0YU7XG5PYnNlcnZhYmxlIC0g0LfQvdCw0YfQtdC90LjQuSjQsiDRgi7Rhy4sINC6INC/0YDQuNC80LXRgNGDLCBTdWJqZWN0ICog0LggRXZlbnRFbWl0dGVyKSDRgdC+0L7RgtCy0LXRgtGB0YLQstGD0Y7RidC40Lkg0Y3Qu9C10LzQtdC90YIg0YTQvtGA0LzRiyDQvdC1INGB0L7Qt9C00LDQtdGC0YHRjy5cbiAqIEBwYXJhbSBzb3VyY2UgINC40YHRgtC+0YfQvdC40Log0LTQsNC90L3Ri9GFINGC0LjQv9CwIFQg0LTQu9GPINGB0L7Qt9C00LDQvdC40Y8g0YTQvtGA0LzRiy5cbiAqIEBwYXJhbSBrZXlzVmFsaWRhdG9yINC+0LHRitC10LrRgiBNYXAg0YEg0LrQvtC90YTQuNCz0YPRgNCw0YbQuNC10Lkg0YHQuNC90YXRgNC+0L3QvdGL0YUg0LLQsNC70LjQtNCw0YLQvtGA0L7QsiDQutC+0L3RgtGA0L7Qu9C+0LIg0YTQvtGA0LzRiy5cbiAqINCSINC60LDRh9C10YHRgtCy0LUg0LrQu9GO0YfQtdC5INC80L7Qs9GD0YIg0LHRi9GC0Ywg0YPQutCw0LfQsNC90Ysg0YHQu9C10LTRg9GO0YnQuNC1INC30L3QsNGH0LXQvdC40Y86XG4gKiAgUHJvcGVydHllc0tleXM8VD4gLSDRgdGC0YDQvtC60L7QstGL0LUg0LrQu9GO0YfQuCDQsiDRgtC40L/QtSBULCDQstC60LvRjtGH0LDRjyDRgdGC0YDQvtC60L7QstGL0LUg0LrQu9GO0YfQuCDQstGB0LXRhSDQstC70L7QttC10L3QvdGL0YUg0YLQuNC/0L7Qsiwg0YDQsNC30LTQtdC70LXQvdC90YvQtSBcIi5cIiAtINGC0L7Rh9C60L7QuS5cbiAgICDQndCw0L/RgNC40LzQtdGAINC40LzQtdC10YLRgdGPINGC0LDQutC+0Lkg0YLQuNC/OlxuICAgIGBgYHRzXG4gICAgICAgICAgICAgICAgICAgIGludGVyZmFjZSBVc2VyIHtcbiAgICAgICAgICAgICAgICAgICAgICBmaXJzdG5hbWU6IHN0cmluZztcbiAgICAgICAgICAgICAgICAgICAgICBsYXN0bmFtZTogc3RyaW5nO1xuICAgICAgICAgICAgICAgICAgICAgIHBob25lOiAge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogc3RyaW5nO1xuICAgICAgICAgICAgICAgICAgICAgICAgbnVtYmVyOiBzdHJpbmc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICBgYGBcbiAgICDQlNC70Y8g0YTQvtGA0LzRiywg0LrQvtGC0L7RgNCw0Y8g0LHRg9C00LXRgiDRgdC+0LfQtNCw0L3QsCDQuNC3INC+0LHRitC10LrRgtCwIFVzZXIg0LIg0LrQvtC90YTQuNCz0YPRgNCw0YbQuNC4INCy0LDQu9C40LTQsNGC0L7RgNC+0LIg0L3QsNC30LLQsNC90LjRjyDQutC+0L3RgtGA0L7Qu9C+0LIg0LzQvtC20L3QviDQsdGD0LTQtdGCINGD0LrQsNC30LDRgtGMINGC0LDQujpcbiAgICBgbGFzdG5hbWVgINC40LvQuGBwaG9uZWAsINC40LvQuGBwaG9uZS5jb2RlYC5cblxuICAgJ21haW4nIC0g0YHQv9C10YbQuNCw0LvRjNC90L7QtSDQt9C90LDRh9C10L3QuNC1LCDRj9Cy0LvRj9GO0YnQtdC10YHRjyDQv9GA0LjQt9C90LDQutC+0Lwg0YLQvtCz0L4sINGH0YLQviDQvNCw0YHRgdC40LIg0LLQsNC70LjQtNCw0YLQvtGA0L7QsiDQvdC10L7QsdGF0L7QtNC40LzQvlxuICAgINC90LDQt9C90LDRh9C40YLRjCDRgdCw0LzQvtC80YMg0L7QsdGK0LXQutGC0YMg0YTQvtGA0LzRiywg0LAg0L3QtSDQstC70L7QttC10L3Ri9C8INC60L7QvdGC0YDQvtC70LDQvC5cblxuICAgJ21haW5JdGVtcycgLSDQuNGB0L/QvtC70YzQt9GD0LXRgtGB0Y8g0YLQvtC70YzQutC+INC10YHQu9C4IHNvdXJjZSDRj9Cy0LvRj9C10YLRgdGPINC80LDRgdGB0LjQstC+0LwuINCh0L/QtdGG0LjQsNC70YzQvdC+0LUg0LfQvdCw0YfQtdC90LjQtSwg0Y/QstC70Y/RjtGJ0LXQtdGB0Y8g0L/RgNC40LfQvdCw0LrQvtC8INGC0L7Qs9C+LFxuICDRh9GC0L4g0LzQsNGB0YHQuNCyINCy0LDQu9C40LTQsNGC0L7RgNC+0LIg0L3QtdC+0LHRhdC+0LTQuNC80L4g0L3QsNC30L3QsNGH0LjRgtGMINC00LvRjyDQstGB0LXRhSDRjdC70LXQvNC10L3RgtC+0LIg0LzQsNGB0YHQuNCy0LAgRm9ybUFycmF5LlxuICogQHBhcmFtIGFzeW5jS2V5c1ZhbGlkYXRvciDQvtCx0YrQtdC60YIgTWFwLCDQsNC90LDQu9C+0LPQuNGH0L3Ri9C5IGtleXNWYWxpZGF0b3IsINC90L4g0LTQu9GPINCw0YHQuNC90YXRgNC+0L3QvdGL0YUg0LLQsNC70LjQtNCw0YLQvtGA0L7QslxuICogQHJldHVybnMg0L7QsdGK0LXQutGCINGC0LjQv9C40LfQuNGA0L7QstCw0L3QvdC+0Lkg0YTQvtGA0LzRiyAtIEZvcm1Hcm91cCwgRm9ybUFycmF5INC40LvQuCBGb3JtQ29udHJvbCDQsiDQt9Cw0LLQuNGB0LjQvNC+0YHRgtC4INC+0YIg0YLQuNC/0LAg0LfQvdCw0YfQtdC90LjRjyBzb3VyY2UuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtYWtlRm9ybTxUIGV4dGVuZHMgdW5rbm93bj4oXG4gIHNvdXJjZTogVCxcbiAgb3B0aW9ucz86IE1hcDxDb250cm9sc05hbWVzPFQ+LCBNYWtlQ29udHJvbE9wdGlvbnM+LFxuKTogU2NhbkZvcm1UeXBlPFQ+IHtcbiAgY29uc3QgZm9ybSA9ICEhc291cmNlICYmICh0eXBlb2Ygc291cmNlID09PSAnb2JqZWN0JyB8fCB0eXBlb2Ygc291cmNlID09PSAnZnVuY3Rpb24nKSA/XG4gICAgc291cmNlIGluc3RhbmNlb2YgQXJyYXk8dW5rbm93bj4gP1xuICAgICAgbWFrZUFycmF5KHNvdXJjZSwgb3B0aW9ucykgOlxuICAgICAgbWFrZUdyb3VwKDxvYmplY3Q+IHNvdXJjZSwgJ21haW4nLCBvcHRpb25zKSA6XG4gICAgbWFrZUNvbnRyb2woPHVuZGVmaW5lZCB8IG51bGwgfCBudW1iZXIgfCBib29sZWFuIHwgc3ltYm9sIHwgc3RyaW5nPiBzb3VyY2UsIG9wdGlvbnMpO1xuICByZXR1cm4gPFNjYW5Gb3JtVHlwZTxUPj4gZm9ybTtcbn07XG5cbmZ1bmN0aW9uIGxpZnRFcnJvcnMoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGwge1xuICBpZiAoY29udHJvbCBpbnN0YW5jZW9mIEZvcm1Db250cm9sKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgYWxsQ29udHJvbHMgPSBjb250cm9sIGluc3RhbmNlb2YgRm9ybUdyb3VwID9cbiAgICAgIE9iamVjdC52YWx1ZXMoY29udHJvbC5jb250cm9scykgOlxuICAgICAgY29udHJvbCBpbnN0YW5jZW9mIEZvcm1BcnJheSA/XG4gICAgICAgIGNvbnRyb2wuY29udHJvbHMgOlxuICAgICAgICBbXTtcbiAgICBjb25zdCBpbnZhbGlkQ29udHJvbHMgPSBhbGxDb250cm9scy5maWx0ZXIoY29udHJvbCA9PiBjb250cm9sLnN0YXR1cyA9PT0gJ0lOVkFMSUQnKTtcbiAgICByZXR1cm4gaW52YWxpZENvbnRyb2xzLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBpbnZhbGlkQ29udHJvbHMucmVkdWNlKFxuICAgICAgKGFjY3VtdWxhdG9yLCBjdXJyZW50KSA9PiB7XG4gICAgICAgIGlmIChjdXJyZW50LmVycm9ycykge1xuICAgICAgICAgIGFkZFZhbGlkYXRpb25FcnJvcnMoY3VycmVudC5lcnJvcnMsIGFjY3VtdWxhdG9yKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yO1xuICAgICAgfSwgPFZhbGlkYXRpb25FcnJvcnM+IHt9XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbGlmdFZhbGlkYXRpb25FcnJvcnMoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGwge1xuICBjb25zdCBhbGxDb250cm9scyA9IGNvbnRyb2wgaW5zdGFuY2VvZiBGb3JtR3JvdXAgP1xuICAgIE9iamVjdC52YWx1ZXMoY29udHJvbC5jb250cm9scykgOlxuICAgIGNvbnRyb2wgaW5zdGFuY2VvZiBGb3JtQXJyYXkgP1xuICAgICAgY29udHJvbC5jb250cm9scyA6XG4gICAgICBbXTtcbiAgY29uc3QgaW52YWxpZENvbnRyb2xzID0gYWxsQ29udHJvbHMuZmlsdGVyKGNvbnRyb2wgPT4gY29udHJvbC5zdGF0dXMgPT09ICdJTlZBTElEJyk7XG4gIGNvbnN0IGVycm9yczogVmFsaWRhdGlvbkVycm9ycyA9IGludmFsaWRDb250cm9scy5sZW5ndGggPT09IDAgPyB7fSA6IGludmFsaWRDb250cm9scy5yZWR1Y2UoXG4gICAgKGFjY3VtdWxhdG9yLCBjdXJyZW50KSA9PiB7XG4gICAgICBpZiAoY3VycmVudC5lcnJvcnMpIHtcbiAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9ycyhjdXJyZW50LmVycm9ycywgYWNjdW11bGF0b3IpO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGlubmVyRXJyb3JzID0gbGlmdFZhbGlkYXRpb25FcnJvcnMoY3VycmVudCk7XG4gICAgICBpZiAoaW5uZXJFcnJvcnMpIHtcbiAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9ycyhpbm5lckVycm9ycywgYWNjdW11bGF0b3IpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBhY2N1bXVsYXRvcjtcbiAgICB9LCA8VmFsaWRhdGlvbkVycm9ycz4ge31cbiAgKTtcbiAgcmV0dXJuIE9iamVjdC52YWx1ZXMoZXJyb3JzKS5sZW5ndGggPT09IDAgPyBudWxsIDogZXJyb3JzO1xufTtcblxuZnVuY3Rpb24gYWRkVmFsaWRhdGlvbkVycm9ycyhhZGRpdGlvbkVycm9yczogVmFsaWRhdGlvbkVycm9ycywgY3VycmVudEVycm9yczogVmFsaWRhdGlvbkVycm9ycykge1xuICBPYmplY3QuZW50cmllcyhhZGRpdGlvbkVycm9ycykuZm9yRWFjaChcbiAgICBlbnRyeSA9PiBjdXJyZW50RXJyb3JzWyBlbnRyeVsgMCBdIF0gPSBlbnRyeVsgMSBdXG4gICk7XG59XG5cbmZ1bmN0aW9uIG1ha2VDb250cm9sPFQgZXh0ZW5kcyB1bmRlZmluZWQgfCBudWxsIHwgbnVtYmVyIHwgYm9vbGVhbiB8IHN5bWJvbCB8IHN0cmluZz4oXG4gIHNvdXJjZTogVCB8IEZvcm1Db250cm9sPFQgfCBudWxsPixcbiAgb3B0aW9ucz86IE1hcDxDb250cm9sc05hbWVzPFQ+LCBNYWtlQ29udHJvbE9wdGlvbnM+XG4pOiBGb3JtQ29udHJvbDxUIHwgbnVsbD4ge1xuICBjb25zdCBjb250cm9sT3B0aW9ucyA9IGdldFZhbGlkYXRvcnNPck51bGwoPENvbnRyb2xzTmFtZXM8VD4+ICdtYWluJywgb3B0aW9ucywgZmFsc2UpO1xuICBjb25zdCByZXN1bHQgPSBzb3VyY2UgaW5zdGFuY2VvZiBGb3JtQ29udHJvbCA/XG4gICAgc291cmNlIDpcbiAgICBuZXcgRm9ybUNvbnRyb2w8VCB8IG51bGw+KFxuICAgICAgISFzb3VyY2UgJiYgdHlwZW9mIHNvdXJjZSA9PSAnc3RyaW5nJyAmJiAoc291cmNlLmluY2x1ZGVzKCcwMDAxLTAxLTAxJykgfHwgc291cmNlLmluY2x1ZGVzKCcxOTcwLTAxLTAxJykpID8gbnVsbCA6IHNvdXJjZVxuICAgICAgLFxuICAgICAge1xuICAgICAgICB2YWxpZGF0b3JzOiBjb250cm9sT3B0aW9ucz8udmFsaWRhdG9ycyxcbiAgICAgICAgYXN5bmNWYWxpZGF0b3JzOiBjb250cm9sT3B0aW9ucz8uYXN5bmNWYWxpZGF0b3JzLFxuICAgICAgICB1cGRhdGVPbjogY29udHJvbE9wdGlvbnM/LnVwZGF0ZU9uLFxuICAgICAgICBub25OdWxsYWJsZTogY29udHJvbE9wdGlvbnM/Lm5vbk51bGxhYmxlXG4gICAgICB9LFxuICAgICk7XG4gIGlmIChjb250cm9sT3B0aW9ucz8uZGlzYWJsZWQpIHtcbiAgICByZXN1bHQuZGlzYWJsZSgpO1xuICB9O1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBtYWtlR3JvdXA8VCBleHRlbmRzIG9iamVjdCA9IG9iamVjdD4oXG4gIHNvdXJjZTogVCB8IEZvcm1Hcm91cFR5cGU8VD4sXG4gIGludGVybmFsS2V5OiBDb250cm9sc05hbWVzPFQ+LFxuICBvcHRpb25zPzogTWFwPENvbnRyb2xzTmFtZXM8VD4sIE1ha2VDb250cm9sT3B0aW9ucz5cbik6IEZvcm1Hcm91cFR5cGU8VD4ge1xuICBjb25zdCBjb250cm9sT3B0aW9ucyA9IGdldFZhbGlkYXRvcnNPck51bGwoaW50ZXJuYWxLZXksIG9wdGlvbnMsIGZhbHNlKTtcbiAgY29uc3QgcmVzdWx0ID0gc291cmNlIGluc3RhbmNlb2YgRm9ybUdyb3VwPHsgWyBLIGluIFN0cmluZ0tleXM8VD4gXTogU2NhbkZvcm1UeXBlPFRbIEsgXT47IH0+ID9cbiAgICBzb3VyY2UgOlxuICAgICg8WyBTdHJpbmdLZXlzPFQ+LCBUWyBTdHJpbmdLZXlzPFQ+IF0gXVtdPiBPYmplY3QuZW50cmllcyhzb3VyY2UpKS5yZWR1Y2UoXG4gICAgICAoYWNjdW11bGF0b3I6IEZvcm1Hcm91cCwgZW50cnk6IFsgU3RyaW5nS2V5czxUPiwgVFsgU3RyaW5nS2V5czxUPiBdIF0pID0+IHtcbiAgICAgICAgY29uc3Qga2V5ID0gZW50cnlbIDAgXTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBlbnRyeVsgMSBdO1xuICAgICAgICBpZiAoISh2YWx1ZSBpbnN0YW5jZW9mIE9ic2VydmFibGUpKSB7XG4gICAgICAgICAgYWNjdW11bGF0b3IuYWRkQ29udHJvbChcbiAgICAgICAgICAgIGtleSxcbiAgICAgICAgICAgICEhdmFsdWUgJiYgKFxuICAgICAgICAgICAgICB2YWx1ZSBpbnN0YW5jZW9mIEZvcm1Hcm91cCB8fCB2YWx1ZSBpbnN0YW5jZW9mIEZvcm1BcnJheSB8fCB2YWx1ZSBpbnN0YW5jZW9mIEZvcm1Db250cm9sXG4gICAgICAgICAgICApID9cbiAgICAgICAgICAgICAgPFNjYW5Gb3JtVHlwZTxUWyBTdHJpbmdLZXlzPFQ+IF0+PiB2YWx1ZSA6XG4gICAgICAgICAgICAgIG1ha2VGb3JtPFRbIFN0cmluZ0tleXM8VD4gXT4oXG4gICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICAgICAgbWFrZU5ld01haW5NYXA8VCwgVFsgU3RyaW5nS2V5czxUPiBdPig8Q29udHJvbHNOYW1lczxUPj4ga2V5LCBvcHRpb25zKSxcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiA8Rm9ybUdyb3VwVHlwZTxUPj4gYWNjdW11bGF0b3I7XG4gICAgICB9LCBuZXcgRm9ybUdyb3VwPHsgWyBLIGluIFN0cmluZ0tleXM8VD4gXTogU2NhbkZvcm1UeXBlPFRbIEsgXT47IH0+KDx7IFsgSyBpbiBTdHJpbmdLZXlzPFQ+IF06IFNjYW5Gb3JtVHlwZTxUWyBLIF0+OyB9PiB7fSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbGlkYXRvcnM6IGNvbnRyb2xPcHRpb25zPy52YWxpZGF0b3JzLFxuICAgICAgICAgIGFzeW5jVmFsaWRhdG9yczogY29udHJvbE9wdGlvbnM/LmFzeW5jVmFsaWRhdG9ycyxcbiAgICAgICAgICB1cGRhdGVPbjogY29udHJvbE9wdGlvbnM/LnVwZGF0ZU9uLFxuICAgICAgICB9LFxuICAgICAgKVxuICAgICk7XG4gIGlmIChjb250cm9sT3B0aW9ucz8uZGlzYWJsZWQpIHtcbiAgICByZXN1bHQuZGlzYWJsZSgpO1xuICB9O1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBtYWtlQXJyYXk8VCBleHRlbmRzIEFycmF5PHVua25vd24+LCBFID0gVCBleHRlbmRzIEFycmF5PGluZmVyIFU+ID8gVSA6IG5ldmVyPihcbiAgc291cmNlOiBFW10gfCBGb3JtQXJyYXk8U2NhbkZvcm1UeXBlPEU+PixcbiAgb3B0aW9ucz86IE1hcDxDb250cm9sc05hbWVzPFQ+LCBNYWtlQ29udHJvbE9wdGlvbnM+XG4pOiBGb3JtQXJyYXk8U2NhbkZvcm1UeXBlPEU+PiB7XG4gIGNvbnN0IGNvbnRyb2xPcHRpb25zID0gZ2V0VmFsaWRhdG9yc09yTnVsbCg8Q29udHJvbHNOYW1lczxUPj4gJ21haW4nLCBvcHRpb25zLCBmYWxzZSk7XG4gIGNvbnN0IHJlc3VsdCA9IHNvdXJjZSBpbnN0YW5jZW9mIEZvcm1BcnJheSA/XG4gICAgc291cmNlIDpcbiAgICBuZXcgRm9ybUFycmF5KFxuICAgICAgc291cmNlLm1hcChcbiAgICAgICAgKGl0ZW06IEUpID0+IHtcbiAgICAgICAgICBjb25zdCBpdGVtRm9ybSA9IG1ha2VGb3JtKFxuICAgICAgICAgICAgaXRlbSxcbiAgICAgICAgICAgIG1ha2VOZXdNYWluTWFwPFQsIEU+KDxDb250cm9sc05hbWVzPFQ+PiAnbWFpbkl0ZW1zJywgb3B0aW9ucyksXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4gaXRlbUZvcm07XG4gICAgICAgIH0pLFxuICAgICAge1xuICAgICAgICB2YWxpZGF0b3JzOiBjb250cm9sT3B0aW9ucz8udmFsaWRhdG9ycyxcbiAgICAgICAgYXN5bmNWYWxpZGF0b3JzOiBjb250cm9sT3B0aW9ucz8uYXN5bmNWYWxpZGF0b3JzLFxuICAgICAgICB1cGRhdGVPbjogY29udHJvbE9wdGlvbnM/LnVwZGF0ZU9uXG4gICAgICB9XG4gICAgKTtcbiAgaWYgKGNvbnRyb2xPcHRpb25zPy5kaXNhYmxlZCkge1xuICAgIHJlc3VsdC5kaXNhYmxlKCk7XG4gIH07XG4gIHJldHVybiByZXN1bHQ7XG59Il19