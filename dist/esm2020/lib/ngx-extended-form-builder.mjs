import { FormGroup, FormArray, FormControl } from "@angular/forms";
import { Observable } from "rxjs";
function getValidatorsOrNull(key, keysValidator, addLift = false) {
    const result = keysValidator && keysValidator.has(key) ? keysValidator.get(key) : null;
    if (addLift) {
        if (result && Array.isArray(result)) {
            result.push(liftErrors);
            return result;
        }
        else {
            return result ? result : [liftErrors];
        }
    }
    else {
        return result;
    }
    ;
}
function makeFormGroup(source, internalKey, keysValidator, asyncKeysValidator) {
    return source instanceof (FormGroup) ?
        source :
        Object.entries(source).reduce((accumulator, entry) => {
            const key = entry[0];
            const value = entry[1];
            if (!(value instanceof Observable)) {
                accumulator.addControl(key, !!value && (value instanceof FormGroup || value instanceof FormArray || value instanceof (FormControl)) ?
                    value :
                    makeForm(value, makeNewMainFormValidatorsMap(key, keysValidator), makeNewMainFormValidatorsMap(key, asyncKeysValidator)));
            }
            ;
            return accumulator;
        }, new FormGroup({}, getValidatorsOrNull(internalKey, keysValidator, true), getValidatorsOrNull(internalKey, asyncKeysValidator, false)));
}
function makeNewMainFormValidatorsMap(key, oldMap) {
    if (!oldMap || key === 'mainFormValidators' || key === 'mainFormValidatorsItems') {
        return oldMap;
    }
    else {
        if (!oldMap.has(key) && !oldMap.has(`${key}Items`)) {
            return new Map(Array.from(oldMap.entries()).filter(item => item[0] !== 'mainFormValidators' && item[0] !== 'mainFormValidatorsItems').map(([entryKey, entryValue]) => [entryKey.startsWith(`${key}.`) ? entryKey.replace(`${key}.`, '') : entryKey, entryValue]));
        }
        else {
            const filterPredicate = oldMap.has('mainFormValidators') ?
                oldMap.has('mainFormValidatorsItems') ?
                    (item) => item[0] !== key && item[0] !== 'mainFormValidators' && item[0] !== 'mainFormValidatorsItems' :
                    (item) => item[0] !== key && item[0] !== 'mainFormValidators' :
                oldMap.has('mainFormValidatorsItems') ?
                    (item) => item[0] !== key && item[0] !== 'mainFormValidatorsItems' :
                    (item) => item[0] !== key;
            const newMainValidatorsArray = oldMap.has(key) ?
                oldMap.has(`${key}Items`) ?
                    [
                        ['mainFormValidators', oldMap.get(key)],
                        ['mainFormValidatorsItems', oldMap.get(`${key}Items`)]
                    ] :
                    [
                        ['mainFormValidators', oldMap.get(key)],
                    ] :
                oldMap.has(`${key}Items`) ?
                    [
                        ['mainFormValidatorsItems', oldMap.get(`${key}Items`)]
                    ] :
                    [];
            return new Map([
                ...newMainValidatorsArray,
                ...Array.from(oldMap.entries()).filter(filterPredicate).map(([entryKey, entryValue]) => [entryKey.startsWith(`${key}.`) ? entryKey.replace(`${key}.`, '') : entryKey, entryValue])
            ]);
        }
        ;
    }
    ;
}
export function makeForm(source, keysValidator, asyncKeysValidator) {
    const form = !!source && (typeof source === 'object' || typeof source === 'function') ?
        source instanceof (Array) ?
            new FormArray(source.map((item) => {
                const itemForm = makeForm(item, makeNewMainFormValidatorsMap('mainFormValidatorsItems', keysValidator), makeNewMainFormValidatorsMap('mainFormValidatorsItems', asyncKeysValidator));
                return itemForm;
            }), getValidatorsOrNull('mainFormValidators', keysValidator, true), getValidatorsOrNull('mainFormValidators', asyncKeysValidator, false)) :
            makeFormGroup(source, 'mainFormValidators', keysValidator, asyncKeysValidator) :
        new FormControl(!!source && typeof source == 'string' && (source.includes('0001-01-01') || source.includes('1970-01-01')) ? null : source, getValidatorsOrNull('mainFormValidators', keysValidator, false), getValidatorsOrNull('mainFormValidators', asyncKeysValidator, false));
    return form;
}
;
function liftErrors(control) {
    if (control instanceof FormControl) {
        return null;
    }
    else {
        const allControls = control instanceof FormGroup ?
            Object.values(control.controls) :
            control instanceof FormArray ?
                control.controls :
                [];
        const invalidControls = allControls.filter(control => control.status === 'INVALID');
        return invalidControls.length === 0 ? null : invalidControls.reduce((accumulator, current) => {
            if (current.errors) {
                addValidationErrors(current.errors, accumulator);
            }
            ;
            return accumulator;
        }, {});
    }
}
export function liftValidationErrors(control) {
    const allControls = control instanceof FormGroup ?
        Object.values(control.controls) :
        control instanceof FormArray ?
            control.controls :
            [];
    const invalidControls = allControls.filter(control => control.status === 'INVALID');
    const errors = invalidControls.length === 0 ? {} : invalidControls.reduce((accumulator, current) => {
        if (current.errors) {
            addValidationErrors(current.errors, accumulator);
        }
        ;
        const innerErrors = liftValidationErrors(current);
        if (innerErrors) {
            addValidationErrors(innerErrors, accumulator);
        }
        ;
        return accumulator;
    }, {});
    return Object.values(errors).length === 0 ? null : errors;
}
;
function addValidationErrors(additionErrors, currentErrors) {
    Object.entries(additionErrors).forEach(entry => currentErrors[entry[0]] = entry[1]);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWV4dGVuZGVkLWZvcm0tYnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Byb2plY3RzL25neC1leHRlbmRlZC1mb3JtLWJ1aWxkZXIvc3JjL2xpYi9uZ3gtZXh0ZW5kZWQtZm9ybS1idWlsZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRW5FLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFxQmxDLFNBQVMsbUJBQW1CLENBQzFCLEdBQVcsRUFBRSxhQUE4QixFQUFFLFVBQW1CLEtBQUs7SUFFckUsTUFBTSxNQUFNLEdBQUcsYUFBYSxJQUFJLGFBQWEsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUN2RixJQUFJLE9BQU8sRUFBRTtRQUNYLElBQUksTUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDbEIsTUFBTyxDQUFDLElBQUksQ0FBZSxVQUFVLENBQUMsQ0FBQztZQUN4RCxPQUFXLE1BQU0sQ0FBQztTQUNuQjthQUFNO1lBQ0wsT0FBTyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUksQ0FBRSxVQUFVLENBQUUsQ0FBQztTQUM1QztLQUNGO1NBQU07UUFDTCxPQUFPLE1BQU0sQ0FBQztLQUNmO0lBQUEsQ0FBQztBQUNKLENBQUM7QUFFRCxTQUFTLGFBQWEsQ0FDcEIsTUFBUyxFQUNULFdBQW1CLEVBQ25CLGFBQWlELEVBQ2pELGtCQUEyRDtJQUUzRCxPQUFPLE1BQU0sYUFBWSxTQUFzRCxDQUFBLENBQUMsQ0FBQztRQUMvRSxNQUFNLENBQUMsQ0FBQztRQUNrRCxNQUFNLENBQUMsT0FB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YSxDQUFFLEtBQUssQ0FBRSxDQUFDLENBQUUsQ0FBRSxHQUFHLEtBQUssQ0FBRSxDQUFDLENBQUUsQ0FDbEQsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1BcnJheSwgRm9ybUNvbnRyb2wgfSBmcm9tIFwiQGFuZ3VsYXIvZm9ybXNcIjtcbmltcG9ydCB0eXBlIHsgVmFsaWRhdG9yRm4sIFZhbGlkYXRpb25FcnJvcnMsIEFzeW5jVmFsaWRhdG9yRm4sIEFic3RyYWN0Q29udHJvbCB9IGZyb20gXCJAYW5ndWxhci9mb3Jtc1wiO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gXCJyeGpzXCI7XG5cbnR5cGUgQXJyYXlFbGVtZW50PFQ+ID0gVCBleHRlbmRzIEFycmF5PGluZmVyIFU+ID8gVSA6IG5ldmVyO1xuZXhwb3J0IHR5cGUgRm9ybUdyb3VwVHlwZTxUPiA9IEZvcm1Hcm91cDx7IFsgSyBpbiBrZXlvZiBUIF06IFNjYW5Gb3JtVHlwZTxUWyBLIF0+OyB9PjtcblxuZXhwb3J0IHR5cGUgU2NhbkZvcm1UeXBlPFQ+ID0gVCBleHRlbmRzIEZvcm1Hcm91cDxpbmZlciBVPiA/XG4gIEZvcm1Hcm91cDxVPiA6XG4gIFQgZXh0ZW5kcyBGb3JtQXJyYXk8aW5mZXIgVT4gP1xuICBGb3JtQXJyYXk8VT4gOlxuICBUIGV4dGVuZHMgRm9ybUNvbnRyb2w8aW5mZXIgVT4gP1xuICBGb3JtQ29udHJvbDxVPiA6XG4gIFQgZXh0ZW5kcyBBcnJheTxpbmZlciBVPiA/XG4gIEZvcm1BcnJheTxTY2FuRm9ybVR5cGU8VT4+IDpcbiAgVCBleHRlbmRzIG51bGwgfCB1bmRlZmluZWQgP1xuICBuZXZlciA6XG4gIFQgZXh0ZW5kcyAoc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbiB8IHN5bWJvbCB8IG51bGwgfCB1bmRlZmluZWQpID8gRm9ybUNvbnRyb2w8VD4gOlxuICBGb3JtR3JvdXBUeXBlPFQ+O1xuXG5cbnR5cGUgSW5uZXJUeXBlPFQsIEsgZXh0ZW5kcyBrZXlvZiBUPiA9IFRbIEsgXTtcblxuZnVuY3Rpb24gZ2V0VmFsaWRhdG9yc09yTnVsbDxUIGV4dGVuZHMgVmFsaWRhdG9yRm5bXSB8IEFzeW5jVmFsaWRhdG9yRm5bXSB8IG51bGw+KFxuICBrZXk6IHN0cmluZywga2V5c1ZhbGlkYXRvcj86IE1hcDxzdHJpbmcsIFQ+LCBhZGRMaWZ0OiBib29sZWFuID0gZmFsc2Vcbik6IFQgfCB1bmRlZmluZWQgfCBudWxsIHtcbiAgY29uc3QgcmVzdWx0ID0ga2V5c1ZhbGlkYXRvciAmJiBrZXlzVmFsaWRhdG9yLmhhcyhrZXkpID8ga2V5c1ZhbGlkYXRvci5nZXQoa2V5KSA6IG51bGw7XG4gIGlmIChhZGRMaWZ0KSB7XG4gICAgaWYgKHJlc3VsdCAmJiBBcnJheS5pc0FycmF5KHJlc3VsdCkpIHtcbiAgICAgICg8VmFsaWRhdG9yRm5bXT4gcmVzdWx0KS5wdXNoKDxWYWxpZGF0b3JGbj4gbGlmdEVycm9ycyk7XG4gICAgICByZXR1cm4gPFQ+IHJlc3VsdDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHJlc3VsdCA/IHJlc3VsdCA6IDxUPlsgbGlmdEVycm9ycyBdO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xufVxuXG5mdW5jdGlvbiBtYWtlRm9ybUdyb3VwPFQ+KFxuICBzb3VyY2U6IFQsXG4gIGludGVybmFsS2V5OiBzdHJpbmcsXG4gIGtleXNWYWxpZGF0b3I/OiBNYXA8c3RyaW5nLCBWYWxpZGF0b3JGbltdIHwgbnVsbD4sXG4gIGFzeW5jS2V5c1ZhbGlkYXRvcj86IE1hcDxzdHJpbmcsIEFzeW5jVmFsaWRhdG9yRm5bXSB8IG51bGw+XG4pOiBGb3JtR3JvdXBUeXBlPFQ+IHtcbiAgcmV0dXJuIHNvdXJjZSBpbnN0YW5jZW9mIEZvcm1Hcm91cDx7IFsgSyBpbiBrZXlvZiBUIF06IFNjYW5Gb3JtVHlwZTxUWyBLIF0+OyB9PiA/XG4gICAgc291cmNlIDpcbiAgICAoPFsgc3RyaW5nICYga2V5b2YgVCwgSW5uZXJUeXBlPFQsIHN0cmluZyAmIGtleW9mIFQ+IF1bXT4gT2JqZWN0LmVudHJpZXMoc291cmNlKSkucmVkdWNlKFxuICAgICAgKGFjY3VtdWxhdG9yOiBGb3JtR3JvdXAsIGVudHJ5OiBbIHN0cmluZyAmIGtleW9mIFQsIElubmVyVHlwZTxULCBzdHJpbmcgJiBrZXlvZiBUPiBdKSA9PiB7XG4gICAgICAgIGNvbnN0IGtleSA9IGVudHJ5WyAwIF07XG4gICAgICAgIGNvbnN0IHZhbHVlID0gZW50cnlbIDEgXTtcbiAgICAgICAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBPYnNlcnZhYmxlKSkge1xuICAgICAgICAgIGFjY3VtdWxhdG9yLmFkZENvbnRyb2woXG4gICAgICAgICAgICBrZXksXG4gICAgICAgICAgICAhIXZhbHVlICYmIChcbiAgICAgICAgICAgICAgdmFsdWUgaW5zdGFuY2VvZiBGb3JtR3JvdXAgfHwgdmFsdWUgaW5zdGFuY2VvZiBGb3JtQXJyYXkgfHwgdmFsdWUgaW5zdGFuY2VvZiBGb3JtQ29udHJvbDxJbm5lclR5cGU8VCwgc3RyaW5nICYga2V5b2YgVD4gfCBudWxsPlxuICAgICAgICAgICAgKSA/XG4gICAgICAgICAgICAgIDxTY2FuRm9ybVR5cGU8SW5uZXJUeXBlPFQsIHN0cmluZyAmIGtleW9mIFQ+Pj4gPHVua25vd24+IHZhbHVlIDpcbiAgICAgICAgICAgICAgbWFrZUZvcm08SW5uZXJUeXBlPFQsIHN0cmluZyAmIGtleW9mIFQ+PihcbiAgICAgICAgICAgICAgICB2YWx1ZSxcbiAgICAgICAgICAgICAgICBtYWtlTmV3TWFpbkZvcm1WYWxpZGF0b3JzTWFwKGtleSwga2V5c1ZhbGlkYXRvciksXG4gICAgICAgICAgICAgICAgbWFrZU5ld01haW5Gb3JtVmFsaWRhdG9yc01hcChrZXksIGFzeW5jS2V5c1ZhbGlkYXRvciksXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gPEZvcm1Hcm91cFR5cGU8VD4+IGFjY3VtdWxhdG9yO1xuICAgICAgfSwgbmV3IEZvcm1Hcm91cDx7IFsgSyBpbiBrZXlvZiBUIF06IFNjYW5Gb3JtVHlwZTxUWyBLIF0+OyB9Pig8eyBbIEsgaW4ga2V5b2YgVCBdOiBTY2FuRm9ybVR5cGU8VFsgSyBdPjsgfT4ge30sXG4gICAgICAgIGdldFZhbGlkYXRvcnNPck51bGwoaW50ZXJuYWxLZXksIGtleXNWYWxpZGF0b3IsIHRydWUpLFxuICAgICAgICBnZXRWYWxpZGF0b3JzT3JOdWxsKGludGVybmFsS2V5LCBhc3luY0tleXNWYWxpZGF0b3IsIGZhbHNlKVxuICAgICAgKVxuICAgICk7XG59XG5cbmZ1bmN0aW9uIG1ha2VOZXdNYWluRm9ybVZhbGlkYXRvcnNNYXA8VCBleHRlbmRzIFZhbGlkYXRvckZuW10gfCBBc3luY1ZhbGlkYXRvckZuW10gfCBudWxsPihcbiAga2V5OiBzdHJpbmcsIG9sZE1hcD86IE1hcDxzdHJpbmcsIFQ+LFxuKTogTWFwPHN0cmluZywgVD4gfCB1bmRlZmluZWQge1xuICBpZiAoIW9sZE1hcCB8fCBrZXkgPT09ICdtYWluRm9ybVZhbGlkYXRvcnMnIHx8IGtleSA9PT0gJ21haW5Gb3JtVmFsaWRhdG9yc0l0ZW1zJykge1xuICAgIHJldHVybiBvbGRNYXA7XG4gIH0gZWxzZSB7XG4gICAgaWYgKCFvbGRNYXAuaGFzKGtleSkgJiYgIW9sZE1hcC5oYXMoYCR7IGtleSB9SXRlbXNgKSkge1xuICAgICAgcmV0dXJuIG5ldyBNYXA8c3RyaW5nLCBUPihcbiAgICAgICAgQXJyYXkuZnJvbShcbiAgICAgICAgICBvbGRNYXAuZW50cmllcygpXG4gICAgICAgICkuZmlsdGVyKFxuICAgICAgICAgIGl0ZW0gPT4gaXRlbVsgMCBdICE9PSAnbWFpbkZvcm1WYWxpZGF0b3JzJyAmJiBpdGVtWyAwIF0gIT09ICdtYWluRm9ybVZhbGlkYXRvcnNJdGVtcydcbiAgICAgICAgKS5tYXAoXG4gICAgICAgICAgKFsgZW50cnlLZXksIGVudHJ5VmFsdWUgXSkgPT4gWyBlbnRyeUtleS5zdGFydHNXaXRoKGAkeyBrZXkgfS5gKSA/IGVudHJ5S2V5LnJlcGxhY2UoYCR7IGtleSB9LmAsICcnKSA6IGVudHJ5S2V5LCBlbnRyeVZhbHVlIF1cbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgZmlsdGVyUHJlZGljYXRlID0gb2xkTWFwLmhhcygnbWFpbkZvcm1WYWxpZGF0b3JzJykgP1xuICAgICAgICBvbGRNYXAuaGFzKCdtYWluRm9ybVZhbGlkYXRvcnNJdGVtcycpID9cbiAgICAgICAgICAoaXRlbTogWyBzdHJpbmcsIFQgXSkgPT4gaXRlbVsgMCBdICE9PSBrZXkgJiYgaXRlbVsgMCBdICE9PSAnbWFpbkZvcm1WYWxpZGF0b3JzJyAmJiBpdGVtWyAwIF0gIT09ICdtYWluRm9ybVZhbGlkYXRvcnNJdGVtcycgOlxuICAgICAgICAgIChpdGVtOiBbIHN0cmluZywgVCBdKSA9PiBpdGVtWyAwIF0gIT09IGtleSAmJiBpdGVtWyAwIF0gIT09ICdtYWluRm9ybVZhbGlkYXRvcnMnIDpcbiAgICAgICAgb2xkTWFwLmhhcygnbWFpbkZvcm1WYWxpZGF0b3JzSXRlbXMnKSA/XG4gICAgICAgICAgKGl0ZW06IFsgc3RyaW5nLCBUIF0pID0+IGl0ZW1bIDAgXSAhPT0ga2V5ICYmIGl0ZW1bIDAgXSAhPT0gJ21haW5Gb3JtVmFsaWRhdG9yc0l0ZW1zJyA6XG4gICAgICAgICAgKGl0ZW06IFsgc3RyaW5nLCBUIF0pID0+IGl0ZW1bIDAgXSAhPT0ga2V5O1xuICAgICAgY29uc3QgbmV3TWFpblZhbGlkYXRvcnNBcnJheTogWyBzdHJpbmcsIFQgXVtdID0gb2xkTWFwLmhhcyhrZXkpID9cbiAgICAgICAgb2xkTWFwLmhhcyhgJHsga2V5IH1JdGVtc2ApID9cbiAgICAgICAgICBbXG4gICAgICAgICAgICBbICdtYWluRm9ybVZhbGlkYXRvcnMnLCBvbGRNYXAuZ2V0KGtleSkhIF0sXG4gICAgICAgICAgICBbICdtYWluRm9ybVZhbGlkYXRvcnNJdGVtcycsIG9sZE1hcC5nZXQoYCR7IGtleSB9SXRlbXNgKSEgXVxuICAgICAgICAgIF0gOlxuICAgICAgICAgIFtcbiAgICAgICAgICAgIFsgJ21haW5Gb3JtVmFsaWRhdG9ycycsIG9sZE1hcC5nZXQoa2V5KSEgXSxcbiAgICAgICAgICBdIDpcbiAgICAgICAgb2xkTWFwLmhhcyhgJHsga2V5IH1JdGVtc2ApID9cbiAgICAgICAgICBbXG4gICAgICAgICAgICBbICdtYWluRm9ybVZhbGlkYXRvcnNJdGVtcycsIG9sZE1hcC5nZXQoYCR7IGtleSB9SXRlbXNgKSEgXVxuICAgICAgICAgIF0gOlxuICAgICAgICAgIFtdO1xuICAgICAgcmV0dXJuIG5ldyBNYXA8c3RyaW5nLCBUPihbXG4gICAgICAgIC4uLm5ld01haW5WYWxpZGF0b3JzQXJyYXksXG4gICAgICAgIC4uLkFycmF5LmZyb20oXG4gICAgICAgICAgb2xkTWFwLmVudHJpZXMoKVxuICAgICAgICApLmZpbHRlcihmaWx0ZXJQcmVkaWNhdGUpLm1hcDxbIHN0cmluZywgVCBdPihcbiAgICAgICAgICAoWyBlbnRyeUtleSwgZW50cnlWYWx1ZSBdKSA9PiBbIGVudHJ5S2V5LnN0YXJ0c1dpdGgoYCR7IGtleSB9LmApID8gZW50cnlLZXkucmVwbGFjZShgJHsga2V5IH0uYCwgJycpIDogZW50cnlLZXksIGVudHJ5VmFsdWUgXVxuICAgICAgICApXG4gICAgICBdKTtcbiAgICB9O1xuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbWFrZUZvcm08VD4oXG4gIHNvdXJjZTogVCxcbiAga2V5c1ZhbGlkYXRvcj86IE1hcDxzdHJpbmcsIFZhbGlkYXRvckZuW10gfCBudWxsPixcbiAgYXN5bmNLZXlzVmFsaWRhdG9yPzogTWFwPHN0cmluZywgQXN5bmNWYWxpZGF0b3JGbltdIHwgbnVsbD4sXG4pOiBTY2FuRm9ybVR5cGU8VD4ge1xuICBjb25zdCBmb3JtID0gISFzb3VyY2UgJiYgKHR5cGVvZiBzb3VyY2UgPT09ICdvYmplY3QnIHx8IHR5cGVvZiBzb3VyY2UgPT09ICdmdW5jdGlvbicpID9cbiAgICBzb3VyY2UgaW5zdGFuY2VvZiBBcnJheTxBcnJheUVsZW1lbnQ8VD4+ID9cbiAgICAgIG5ldyBGb3JtQXJyYXkoXG4gICAgICAgIHNvdXJjZS5tYXAoXG4gICAgICAgICAgKGl0ZW06IEFycmF5RWxlbWVudDxUPikgPT4ge1xuICAgICAgICAgICAgY29uc3QgaXRlbUZvcm0gPSBtYWtlRm9ybShcbiAgICAgICAgICAgICAgaXRlbSxcbiAgICAgICAgICAgICAgbWFrZU5ld01haW5Gb3JtVmFsaWRhdG9yc01hcCgnbWFpbkZvcm1WYWxpZGF0b3JzSXRlbXMnLCBrZXlzVmFsaWRhdG9yKSxcbiAgICAgICAgICAgICAgbWFrZU5ld01haW5Gb3JtVmFsaWRhdG9yc01hcCgnbWFpbkZvcm1WYWxpZGF0b3JzSXRlbXMnLCBhc3luY0tleXNWYWxpZGF0b3IpXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgcmV0dXJuIGl0ZW1Gb3JtO1xuICAgICAgICAgIH0pLFxuICAgICAgICBnZXRWYWxpZGF0b3JzT3JOdWxsKCdtYWluRm9ybVZhbGlkYXRvcnMnLCBrZXlzVmFsaWRhdG9yLCB0cnVlKSxcbiAgICAgICAgZ2V0VmFsaWRhdG9yc09yTnVsbCgnbWFpbkZvcm1WYWxpZGF0b3JzJywgYXN5bmNLZXlzVmFsaWRhdG9yLCBmYWxzZSlcbiAgICAgICkgOlxuICAgICAgbWFrZUZvcm1Hcm91cDxUPihzb3VyY2UsICdtYWluRm9ybVZhbGlkYXRvcnMnLCBrZXlzVmFsaWRhdG9yLCBhc3luY0tleXNWYWxpZGF0b3IpIDpcbiAgICBuZXcgRm9ybUNvbnRyb2w8VCB8IG51bGw+KFxuICAgICAgISFzb3VyY2UgJiYgdHlwZW9mIHNvdXJjZSA9PSAnc3RyaW5nJyAmJiAoc291cmNlLmluY2x1ZGVzKCcwMDAxLTAxLTAxJykgfHwgc291cmNlLmluY2x1ZGVzKCcxOTcwLTAxLTAxJykpID8gbnVsbCA6IHNvdXJjZVxuICAgICAgLFxuICAgICAgZ2V0VmFsaWRhdG9yc09yTnVsbCgnbWFpbkZvcm1WYWxpZGF0b3JzJywga2V5c1ZhbGlkYXRvciwgZmFsc2UpLFxuICAgICAgZ2V0VmFsaWRhdG9yc09yTnVsbCgnbWFpbkZvcm1WYWxpZGF0b3JzJywgYXN5bmNLZXlzVmFsaWRhdG9yLCBmYWxzZSlcbiAgICApO1xuICByZXR1cm4gPFNjYW5Gb3JtVHlwZTxUPj4gZm9ybTtcbn07XG5cbmZ1bmN0aW9uIGxpZnRFcnJvcnMoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGwge1xuICBpZiAoY29udHJvbCBpbnN0YW5jZW9mIEZvcm1Db250cm9sKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgYWxsQ29udHJvbHMgPSBjb250cm9sIGluc3RhbmNlb2YgRm9ybUdyb3VwID9cbiAgICAgIE9iamVjdC52YWx1ZXMoY29udHJvbC5jb250cm9scykgOlxuICAgICAgY29udHJvbCBpbnN0YW5jZW9mIEZvcm1BcnJheSA/XG4gICAgICAgIGNvbnRyb2wuY29udHJvbHMgOlxuICAgICAgICBbXTtcbiAgICBjb25zdCBpbnZhbGlkQ29udHJvbHMgPSBhbGxDb250cm9scy5maWx0ZXIoY29udHJvbCA9PiBjb250cm9sLnN0YXR1cyA9PT0gJ0lOVkFMSUQnKTtcbiAgICByZXR1cm4gaW52YWxpZENvbnRyb2xzLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBpbnZhbGlkQ29udHJvbHMucmVkdWNlKFxuICAgICAgKGFjY3VtdWxhdG9yLCBjdXJyZW50KSA9PiB7XG4gICAgICAgIGlmIChjdXJyZW50LmVycm9ycykge1xuICAgICAgICAgIGFkZFZhbGlkYXRpb25FcnJvcnMoY3VycmVudC5lcnJvcnMsIGFjY3VtdWxhdG9yKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGFjY3VtdWxhdG9yO1xuICAgICAgfSwgPFZhbGlkYXRpb25FcnJvcnM+IHt9XG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbGlmdFZhbGlkYXRpb25FcnJvcnMoY29udHJvbDogQWJzdHJhY3RDb250cm9sKTogVmFsaWRhdGlvbkVycm9ycyB8IG51bGwge1xuICBjb25zdCBhbGxDb250cm9scyA9IGNvbnRyb2wgaW5zdGFuY2VvZiBGb3JtR3JvdXAgP1xuICAgIE9iamVjdC52YWx1ZXMoY29udHJvbC5jb250cm9scykgOlxuICAgIGNvbnRyb2wgaW5zdGFuY2VvZiBGb3JtQXJyYXkgP1xuICAgICAgY29udHJvbC5jb250cm9scyA6XG4gICAgICBbXTtcbiAgY29uc3QgaW52YWxpZENvbnRyb2xzID0gYWxsQ29udHJvbHMuZmlsdGVyKGNvbnRyb2wgPT4gY29udHJvbC5zdGF0dXMgPT09ICdJTlZBTElEJyk7XG4gIGNvbnN0IGVycm9yczogVmFsaWRhdGlvbkVycm9ycyA9IGludmFsaWRDb250cm9scy5sZW5ndGggPT09IDAgPyB7fSA6IGludmFsaWRDb250cm9scy5yZWR1Y2UoXG4gICAgKGFjY3VtdWxhdG9yLCBjdXJyZW50KSA9PiB7XG4gICAgICBpZiAoY3VycmVudC5lcnJvcnMpIHtcbiAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9ycyhjdXJyZW50LmVycm9ycywgYWNjdW11bGF0b3IpO1xuICAgICAgfTtcbiAgICAgIGNvbnN0IGlubmVyRXJyb3JzID0gbGlmdFZhbGlkYXRpb25FcnJvcnMoY3VycmVudCk7XG4gICAgICBpZiAoaW5uZXJFcnJvcnMpIHtcbiAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9ycyhpbm5lckVycm9ycywgYWNjdW11bGF0b3IpO1xuICAgICAgfTtcbiAgICAgIHJldHVybiBhY2N1bXVsYXRvcjtcbiAgICB9LCA8VmFsaWRhdGlvbkVycm9ycz4ge31cbiAgKTtcbiAgcmV0dXJuIE9iamVjdC52YWx1ZXMoZXJyb3JzKS5sZW5ndGggPT09IDAgPyBudWxsIDogZXJyb3JzO1xufTtcblxuZnVuY3Rpb24gYWRkVmFsaWRhdGlvbkVycm9ycyhhZGRpdGlvbkVycm9yczogVmFsaWRhdGlvbkVycm9ycywgY3VycmVudEVycm9yczogVmFsaWRhdGlvbkVycm9ycykge1xuICBPYmplY3QuZW50cmllcyhhZGRpdGlvbkVycm9ycykuZm9yRWFjaChcbiAgICBlbnRyeSA9PiBjdXJyZW50RXJyb3JzWyBlbnRyeVsgMCBdIF0gPSBlbnRyeVsgMSBdXG4gICk7XG59Il19