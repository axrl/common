import { FormGroup, FormArray, FormControl } from "@angular/forms";
import { Observable } from "rxjs";
function getValidatorsOrNull(key, options, addLift = false) {
    const result = options && options.has(key) ? options.get(key) : null;
    if (addLift) {
        if (result && result.validators) {
            result.validators.push(liftErrors);
            return result;
        }
        else {
            if (result) {
                result.validators = [liftErrors];
                return result;
            }
            else {
                return {
                    validators: [liftErrors]
                };
            }
            ;
        }
    }
    else {
        return result;
    }
    ;
}
function makeNewMainMap(key, oldMap) {
    if (!oldMap || key === 'main') {
        return oldMap;
    }
    else {
        if (!oldMap.has(key) && !oldMap.has(`${key}Items`)) {
            return new Map(Array.from(oldMap.entries()).filter(item => item[0] !== 'main' && item[0] !== 'mainItems').map(([entryKey, entryValue]) => [(entryKey.startsWith(`${key}.`) ? entryKey.replace(`${key}.`, '') : entryKey), entryValue]));
        }
        else {
            const filterPredicate = oldMap.has('main') ?
                oldMap.has('mainItems') ?
                    (item) => {
                        const pre = item[0] !== (key + 'Items');
                        return item[0] !== key && pre && item[0] !== 'main' && item[0] !== 'mainItems';
                    } :
                    (item) => {
                        const pre = item[0] !== (key + 'Items');
                        return item[0] !== key && key[0] !== (key + 'Items') && item[0] !== 'main';
                    } :
                oldMap.has('mainItems') ?
                    (item) => {
                        const pre = item[0] !== (key + 'Items');
                        return item[0] !== key && pre && item[0] !== 'mainItems';
                    } :
                    (item) => {
                        const pre = item[0] !== (key + 'Items');
                        return item[0] !== key && pre;
                    };
            const newMainValidatorsArray = oldMap.has(key) ?
                oldMap.has(`${key}Items`) ?
                    [
                        ['main', oldMap.get(key)],
                        ['mainItems', oldMap.get(`${key}Items`)]
                    ] :
                    [
                        ['main', oldMap.get(key)],
                    ] :
                oldMap.has(`${key}Items`) ?
                    [
                        ['mainItems', oldMap.get(`${key}Items`)]
                    ] :
                    [];
            const filtered = Array.from(oldMap.entries()).filter(filterPredicate);
            const result = new Map([
                ...newMainValidatorsArray,
                ...filtered.map(([entryKey, entryValue]) => [(entryKey.startsWith(`${key}.`) ?
                        entryKey.replace(`${key}.`, '') :
                        entryKey.startsWith(`${key}Items.`) ?
                            entryKey.replace(`${key}Items.`, '') :
                            entryKey), entryValue])
            ]);
            return result;
        }
        ;
    }
    ;
}
/**
@function makeForm<T>
  Фабричная функция для создания Angular Reactive Form.
В отличие от стандартного FormBuilder - а в пакете @angular/forms, при создании формы из сложных объектов,
сохраняется вложенность контролов - каждый вложенный объект превращается во вложенную FormGroup,
  обычные свойства объектов становятся FormControl - ами, а массивы - FormArray - ми.
При этом создаваемая форма имеет более строгую типизацию.

  ВАЖНО!
   Чтобы избежать ошибки переполнения стэка вызовов в рекурсивном процессе создания формы, для любых;
Observable - значений(в т.ч., к примеру, Subject * и EventEmitter) соответствующий элемент формы не создается.
 * @param source  источник данных типа T для создания формы.
 * @param keysValidator объект Map с конфигурацией синхронных валидаторов контролов формы.
 * В качестве ключей могут быть указаны следующие значения:
 *  PropertyesKeys<T> - строковые ключи в типе T, включая строковые ключи всех вложенных типов, разделенные "." - точкой.
    Например имеется такой тип:
    ```ts
                    interface User {
                      firstname: string;
                      lastname: string;
                      phone:  {
                        code: string;
                        number: string;
                        }
                      };
    ```
    Для формы, которая будет создана из объекта User в конфигурации валидаторов названия контролов можно будет указать так:
    `lastname` или`phone`, или`phone.code`.

   'main' - специальное значение, являющееся признаком того, что массив валидаторов необходимо
    назначить самому объекту формы, а не вложеным контролам.

   'mainItems' - используется только если source является массивом. Специальное значение, являющееся признаком того,
  что массив валидаторов необходимо назначить для всех элементов массива FormArray.
 * @param asyncKeysValidator объект Map, аналогичный keysValidator, но для асинхронных валидаторов
 * @returns объект типизированной формы - FormGroup, FormArray или FormControl в зависимости от типа значения source.
 */
export function makeForm(source, options) {
    const form = !!source && (typeof source === 'object' || typeof source === 'function') ?
        source instanceof (Array) ?
            makeArray(source, options) :
            makeGroup(source, 'main', options) :
        makeControl(source, options);
    return form;
}
;
function liftErrors(control) {
    if (control instanceof FormControl) {
        return null;
    }
    else {
        const allControls = control instanceof FormGroup ?
            Object.values(control.controls) :
            control instanceof FormArray ?
                control.controls :
                [];
        const invalidControls = allControls.filter(control => control.status === 'INVALID');
        return invalidControls.length === 0 ? null : invalidControls.reduce((accumulator, current) => {
            if (current.errors) {
                addValidationErrors(current.errors, accumulator);
            }
            ;
            return accumulator;
        }, {});
    }
}
export function liftValidationErrors(control) {
    const allControls = control instanceof FormGroup ?
        Object.values(control.controls) :
        control instanceof FormArray ?
            control.controls :
            [];
    const invalidControls = allControls.filter(control => control.status === 'INVALID');
    const errors = invalidControls.length === 0 ? {} : invalidControls.reduce((accumulator, current) => {
        if (current.errors) {
            addValidationErrors(current.errors, accumulator);
        }
        ;
        const innerErrors = liftValidationErrors(current);
        if (innerErrors) {
            addValidationErrors(innerErrors, accumulator);
        }
        ;
        return accumulator;
    }, {});
    return Object.values(errors).length === 0 ? null : errors;
}
;
function addValidationErrors(additionErrors, currentErrors) {
    Object.entries(additionErrors).forEach(entry => currentErrors[entry[0]] = entry[1]);
}
function makeControl(source, options) {
    const controlOptions = getValidatorsOrNull('main', options, false);
    const result = source instanceof FormControl ?
        source :
        new FormControl(!!source && typeof source == 'string' && (source.includes('0001-01-01') || source.includes('1970-01-01')) ? null : source, {
            validators: controlOptions?.validators,
            asyncValidators: controlOptions?.asyncValidators,
            updateOn: controlOptions?.updateOn,
            nonNullable: controlOptions?.nonNullable
        });
    if (controlOptions?.disabled) {
        result.disable();
    }
    ;
    return result;
}
function makeGroup(source, internalKey, options) {
    const controlOptions = getValidatorsOrNull(internalKey, options, false);
    const result = source instanceof (FormGroup) ?
        source :
        Object.entries(source).reduce((accumulator, entry) => {
            const key = entry[0];
            const value = entry[1];
            if (!(value instanceof Observable)) {
                accumulator.addControl(key, !!value && (value instanceof FormGroup || value instanceof FormArray || value instanceof FormControl) ?
                    value :
                    makeForm(value, makeNewMainMap(key, options)));
            }
            ;
            return accumulator;
        }, new FormGroup({}, {
            validators: controlOptions?.validators,
            asyncValidators: controlOptions?.asyncValidators,
            updateOn: controlOptions?.updateOn,
        }));
    if (controlOptions?.disabled) {
        result.disable();
    }
    ;
    return result;
}
function makeArray(source, options) {
    const controlOptions = getValidatorsOrNull('main', options, false);
    const result = source instanceof FormArray ?
        source :
        new FormArray(source.map((item) => {
            const itemForm = makeForm(item, makeNewMainMap('mainItems', options));
            return itemForm;
        }), {
            validators: controlOptions?.validators,
            asyncValidators: controlOptions?.asyncValidators,
            updateOn: controlOptions?.updateOn
        });
    if (controlOptions?.disabled) {
        result.disable();
    }
    ;
    return result;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWV4dGVuZGVkLWZvcm0tYnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Byb2plY3RzL25neC1leHRlbmRlZC1mb3JtLWJ1aWxkZXIvc3JjL2xpYi9uZ3gtZXh0ZW5kZWQtZm9ybS1idWlsZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRW5FLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUE4RmxDLFNBQVMsbUJBQW1CLENBQzFCLEdBQXFCLEVBQ3JCLE9BQW1ELEVBQ25ELFVBQW1CLEtBQUs7SUFFeEIsTUFBTSxNQUFNLEdBQUcsT0FBTyxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNyRSxJQUFJLE9BQU8sRUFBRTtRQUNYLElBQUksTUFBTSxJQUFJLE1BQU0sQ0FBQyxVQUFVLEVBQUU7WUFDL0IsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQWMsVUFBVSxDQUFDLENBQUM7WUFDaEQsT0FBTyxNQUFNLENBQUM7U0FDZjthQUFNO1lBQ0wsSUFBSSxNQUFNLEVBQUU7Z0JBQ1YsTUFBTSxDQUFDLFVBQVUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUNqQyxPQUFPLE1BQU0sQ0FBQzthQUNmO2lCQUFNO2dCQUNMLE9BQU87b0JBQ0wsVUFBVSxFQUFFLENBQUMsVUFBVSxDQUFDO2lCQUN6QixDQUFDO2FBQ0g7WUFBQSxDQUFDO1NBQ0g7S0FDRjtTQUFNO1FBQ0wsT0FBTyxNQUFNLENBQUM7S0FDZjtJQUFBLENBQUM7QUFDSixDQUFDO0FBRUQsU0FBUyxjQUFjLENBQ3JCLEdBQXFCLEVBQ3JCLE1BQWtEO0lBRWxELElBQUks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QVE7U0FDbkMsQ0FDRixDQUNGLENBQUM7SUFDSixJQUFJLGNBQWMsRUFBRSxRQUFRLEVBQUU7UUFDNUIsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDO0tBQ2xCO0lBQUEsQ0FBQztJQUNGLE9BQU8sTUFBTSxDQUFDO0FBQ2hCLENBQUM7QUFFRCxTQUFTLFNBQVMsQ0FDaEIsTUFBd0MsRUFDeEMsT0FBbUQ7SUFFbkQsTUFBTSxjQUFjLEdBQUcsbUJBQW1CLENBQW1CLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDckYsTUFBTSxNQUFNLEdBQUcsTUFBTSxZQUFZLFNBQVMsQ0FBQyxDQUFDO1FBQzFDLE1BQU0sQ0FBQyxDQUFDO1FBQ1IsSUFBSSxTQUFTLENBQ1gsTUFBTSxDQUFDLEdBQUcsQ0FDUixDQUFDLElBQU8sRUFBRSxFQUFFO1lBQ1YsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUN2QixJQUFJLEVBQ0osY0FBYyxDQUF5QixXQUFXLEVBQUUsT0FBTyxDQUFDLENBQzdELENBQUM7WUFDRixPQUFPLFFBQVEsQ0FBQztRQUNsQixDQUFDLENBQUMsRUFDSjtZQUNFLFVBQVUsRUFBRSxjQUFjLEVBQUUsVUFBVTtZQUN0QyxlQUFlLEVBQUUsY0FBYyxFQUFFLGVBQWU7WUFDaEQsUUFBUSxFQUFFLGNBQWMsRUFBRSxRQUFRO1NBQ25DLENBQ0YsQ0FBQztJQUNKLElBQUksY0FBYyxFQUFFLFFBQVEsRUFBRTtRQUM1QixNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7S0FDbEI7SUFBQSxDQUFDO0lBQ0YsT0FBTyxNQUFNLENBQUM7QUFDaEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZvcm1Hcm91cCwgRm9ybUFycmF5LCBGb3JtQ29udHJvbCB9IGZyb20gXCJAYW5ndWxhci9mb3Jtc1wiO1xyXG5pbXBvcnQgdHlwZSB7IFZhbGlkYXRvckZuLCBWYWxpZGF0aW9uRXJyb3JzLCBBc3luY1ZhbGlkYXRvckZuLCBBYnN0cmFjdENvbnRyb2wsIEZvcm1Db250cm9sT3B0aW9ucyB9IGZyb20gXCJAYW5ndWxhci9mb3Jtc1wiO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSBcInJ4anNcIjtcclxuXHJcbi8qKlxyXG4gKiDQktGB0L/QvtC80L7Qs9Cw0YLQtdC70YzQvdCw0Y8g0YPRgtC40LvQuNGC0LAg0YLQuNC/0LAuXHJcbiAqINCd0LAg0LLRhdC+0LQg0L/RgNC40L3QuNC80LDQtdGCINC90LXQutC40Lkg0YLQuNC/IFQsINCy0L7Qt9Cy0YDQsNGJ0LDQtdGCINGB0L/QuNGB0L7QuiDRgtC+0LvRjNC60L4g0YHRgtGA0L7QutC+0LLRi9GFINC60LvRjtGH0LXQuSDRjdGC0L7Qs9C+INGC0LjQv9CwLCDQv9GA0Lgg0Y3RgtC+0Lwg0LfQvdCw0YfQtdC90LjRjyDRjdGC0LjRhSDQutC70Y7Rh9C10Lkg0L3QtSDRj9Cy0LvRj9GO0YLRgdGPIE9ic2VydmFibGUuXHJcbiAqL1xyXG5leHBvcnQgdHlwZSBTdHJpbmdLZXlzPFQ+ID0ge1xyXG4gIFtLIGluIGtleW9mIFRdOiBUW0tdIGV4dGVuZHMgT2JzZXJ2YWJsZTx1bmtub3duPiA/XHJcbiAgbmV2ZXIgOlxyXG4gIEsgZXh0ZW5kcyBzdHJpbmcgP1xyXG4gIEsgOiBuZXZlcjtcclxufVtrZXlvZiBUXTtcclxuXHJcbi8qKlxyXG4gKiDQktGB0L/QvtC80L7Qs9Cw0YLQtdC70YzQvdGL0LkgYWxpYXMt0YLQuNC/INC60LvRjtGH0LXQuSDQsiDQvtCx0YrQtdC60YLQtSBNYXAsINGB0L7QtNC10YDQttCw0YnQtdC8INC60L7QvdGE0LjQs9GD0YDQsNGG0LjRjiDQstCw0LvQuNC00LDRgtC+0YDQvtCyINC60L7QvdGC0YDQvtC70L7Qsi5cclxuICovXHJcbmV4cG9ydCB0eXBlIENvbnRyb2xzTmFtZXM8VD4gPSBUIGV4dGVuZHMgT2JzZXJ2YWJsZTx1bmtub3duPiA/XHJcbiAgbmV2ZXIgOlxyXG4gIFQgZXh0ZW5kcyBBcnJheTxpbmZlciBVPiA/XHJcbiAgJ21haW4nIHwgJ21haW5JdGVtcycgfCBgbWFpbkl0ZW1zLiR7UHJvcGVydHllc0tleXM8VT59YCA6XHJcbiAgJ21haW4nIHwgUHJvcGVydHllc0tleXM8VD47XHJcbi8qKlxyXG4gKiDQktGB0L/QvtC80L7Qs9Cw0YLQtdC70YzQvdCw0Y8g0YPRgtC40LvQuNGC0LAg0YLQuNC/0LAuXHJcbiAqINCd0LAg0LLRhdC+0LQg0L/RgNC40L3QuNC80LDQtdGCINC90LXQutC40Lkg0YLQuNC/IFQsINCy0L7Qt9Cy0YDQsNGJ0LDQtdGCINGC0L7Qu9GM0LrQviDRgdGC0YDQvtC60L7QstGL0LUg0LrQu9GO0YfQuCDRjdGC0L7Qs9C+INGC0LjQv9CwLlxyXG4gKi9cclxuZXhwb3J0IHR5cGUgUHJvcGVydHllc0tleXM8VD4gPSBUIGV4dGVuZHMgdW5kZWZpbmVkIHwgbnVsbCB8IG51bWJlciB8IGJvb2xlYW4gfCBzeW1ib2wgfCBPYnNlcnZhYmxlPHVua25vd24+ID9cclxuICBuZXZlciA6XHJcbiAgVCBleHRlbmRzIHN0cmluZyA/XHJcbiAgVCA6XHJcbiAgVCBleHRlbmRzIEFycmF5PGluZmVyIFU+ID9cclxuICBQcm9wZXJ0eWVzS2V5czxVPiA6XHJcbiAge1xyXG4gICAgW0sgaW4ga2V5b2YgVF0tPzogSyBleHRlbmRzIHN0cmluZyA/XHJcbiAgICBUW0tdIGV4dGVuZHMgKHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW4gfCBzeW1ib2wgfCB1bmRlZmluZWQgfCBudWxsKSA/XHJcbiAgICBLIDpcclxuICAgIFRbS10gZXh0ZW5kcyBPYnNlcnZhYmxlPHVua25vd24+ID9cclxuICAgIG5ldmVyIDpcclxuICAgIFRbS10gZXh0ZW5kcyBBcnJheTxpbmZlciBVPiA/XHJcbiAgICBgJHtLfUl0ZW1zLiR7UHJvcGVydHllc0tleXM8VT59YCB8IGAke0t9SXRlbXNgIHwgSyA6XHJcbiAgICBgJHtLfS4ke1Byb3BlcnR5ZXNLZXlzPFRbS10+fWAgfCBLIDogbmV2ZXJcclxuICB9W2tleW9mIFRdO1xyXG4vKipcclxuICog0KPQv9GA0L7RidC10L3QvdCw0Y8g0LfQsNC/0LjRgdGMINC00LvRjyDRgtC40L/QsCDQvtCx0YrQtdC60YLQsCBGb3JtR3JvdXAsINC+0LHRgNCw0LfQvtCy0LDQvdC90L7Qs9C+INC40Lcg0YLQuNC/0LAgVC5cclxuICovXHJcbmV4cG9ydCB0eXBlIEZvcm1Hcm91cFR5cGU8VD4gPSBGb3JtR3JvdXA8e1xyXG4gIFtLIGluIFN0cmluZ0tleXM8VD5dOiBUW0tdIGV4dGVuZHMgc3RyaW5nID9cclxuICBGb3JtQ29udHJvbDxUW0tdPiA6XHJcbiAgVFtLXSBleHRlbmRzIGJvb2xlYW4gP1xyXG4gIEZvcm1Db250cm9sPGJvb2xlYW4+IDpcclxuICBUW0tdIGV4dGVuZHMgbnVtYmVyID9cclxuICBGb3JtQ29udHJvbDxudW1iZXI+IDpcclxuICBUIGV4dGVuZHMgc3ltYm9sID9cclxuICBGb3JtQ29udHJvbDxUW0tdPiA6XHJcbiAgU2NhbkZvcm1UeXBlPFRbS10+XHJcbn0+O1xyXG5cclxuLypcclxuZXhwb3J0IHR5cGUgRm9ybUdyb3VwVHlwZTxUIGV4dGVuZHMgb2JqZWN0PiA9IEZvcm1Hcm91cDx7XHJcbiAgW0sgaW4ga2V5b2YgVF06IFRbS10gZXh0ZW5kcyBzdHJpbmcgP1xyXG4gIEZvcm1Db250cm9sPFRbS10+IDpcclxuICBUW0tdIGV4dGVuZHMgYm9vbGVhbiA/XHJcbiAgRm9ybUNvbnRyb2w8VFtLXT4gOlxyXG4gIFRbS10gZXh0ZW5kcyBudW1iZXIgP1xyXG4gIEZvcm1Db250cm9sPG51bWJlcj4gOlxyXG4gIFQgZXh0ZW5kcyBzeW1ib2wgP1xyXG4gIEZvcm1Db250cm9sPFQ+IDpcclxuICBTY2FuRm9ybVR5cGU8VFtLXT47XHJcbn0+OyovXHJcblxyXG4vKipcclxuICog0KPQvdC40LLQtdGA0YHQsNC70YzQvdGL0Lkg0YLQuNC/LdGD0YLQuNC70LjRgtCwLlxyXG4gKiDQlNC70Y8g0LvRjtCx0L7Qs9C+INGC0LjQv9CwINCiINCy0YvQstC+0LTQuNGCINC/0YDQsNCy0LjQu9GM0L3Ri9C5INGC0LjQvyDRgdC+0LfQtNCw0LLQsNC10LzQvtC5INGE0L7RgNC80YssINCy0LrQu9GO0YfQsNGPINC70Y7QsdC+0Lkg0YPRgNC+0LLQtdC90Ywg0LLQu9C+0LbQtdC90L3QvtGB0YLQuC5cclxuICog0JLQkNCW0J3QniFcclxuICog0KfRgtC+0LHRiyDQuNC30LHQtdC20LDRgtGMINC+0YjQuNCx0LrQuCDQv9C10YDQtdC/0L7Qu9C90LXQvdC40Y8g0YHRgtGN0LrQsCDQstGL0LfQvtCy0L7QsiDQsiDRgNC10LrRg9GA0YHQuNCy0L3QvtC8INC/0YDQvtGG0LXRgdGB0LUg0YHQvtC30LTQsNC90LjRjyDRhNC+0YDQvNGLLCDQtNC70Y8g0LvRjtCx0YvRhVxyXG4gKiBPYnNlcnZhYmxlLdC30L3QsNGH0LXQvdC40LkgKCDQsiDRgi7Rhy4sINC6INC/0YDQuNC80LXRgNGDLCBTdWJqZWN0ICAqINC4IEV2ZW50RW1pdHRlcikg0YHQvtC+0YLQstC10YLRgdGC0LLRg9GO0YnQuNC5INGN0LvQtdC80LXQvdGCINGE0L7RgNC80Ysg0L3QtSDRgdC+0LfQtNCw0LXRgtGB0Y8uXHJcbiAqIFNjYW5Gb3JtVHlwZSDRjdGC0L4g0YLQsNC60LbQtSDRg9GH0LjRgtGL0LLQsNC10YIuXHJcbiAqL1xyXG5leHBvcnQgdHlwZSBTY2FuRm9ybVR5cGU8VD4gPSBUIGV4dGVuZHMgQWJzdHJhY3RDb250cm9sPHVua25vd24sIHVua25vd24+ID9cclxuICBUIDpcclxuICBUIGV4dGVuZHMgbnVsbCB8IHVuZGVmaW5lZCA/XHJcbiAgbmV2ZXIgOlxyXG4gIFQgZXh0ZW5kcyBBcnJheTxpbmZlciBVPiA/XHJcbiAgRm9ybUFycmF5PFNjYW5Gb3JtVHlwZTxVPj4gOlxyXG4gIFQgZXh0ZW5kcyBvYmplY3QgP1xyXG4gIEZvcm1Hcm91cFR5cGU8VD4gOlxyXG4gIEZvcm1Db250cm9sPFQ+XHJcbiAgO1xyXG5cclxudHlwZSBNYWtlQ29udHJvbE9wdGlvbnMgPSBPbWl0PEZvcm1Db250cm9sT3B0aW9ucywgJ3ZhbGlkYXRvcnMnIHwgJ2FzeW5jVmFsaWRhdG9ycyc+ICYge1xyXG4gIGRpc2FibGVkPzogYm9vbGVhbjtcclxuICB2YWxpZGF0b3JzPzogVmFsaWRhdG9yRm5bXTtcclxuICBhc3luY1ZhbGlkYXRvcnM/OiBBc3luY1ZhbGlkYXRvckZuW107XHJcbn07XHJcblxyXG5mdW5jdGlvbiBnZXRWYWxpZGF0b3JzT3JOdWxsPFQ+KFxyXG4gIGtleTogQ29udHJvbHNOYW1lczxUPixcclxuICBvcHRpb25zPzogTWFwPENvbnRyb2xzTmFtZXM8VD4sIE1ha2VDb250cm9sT3B0aW9ucz4sXHJcbiAgYWRkTGlmdDogYm9vbGVhbiA9IGZhbHNlXHJcbik6IE1ha2VDb250cm9sT3B0aW9ucyB8IG51bGwgfCB1bmRlZmluZWQge1xyXG4gIGNvbnN0IHJlc3VsdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5oYXMoa2V5KSA/IG9wdGlvbnMuZ2V0KGtleSkgOiBudWxsO1xyXG4gIGlmIChhZGRMaWZ0KSB7XHJcbiAgICBpZiAocmVzdWx0ICYmIHJlc3VsdC52YWxpZGF0b3JzKSB7XHJcbiAgICAgIHJlc3VsdC52YWxpZGF0b3JzLnB1c2goPFZhbGlkYXRvckZuPmxpZnRFcnJvcnMpO1xyXG4gICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgIHJlc3VsdC52YWxpZGF0b3JzID0gW2xpZnRFcnJvcnNdO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHZhbGlkYXRvcnM6IFtsaWZ0RXJyb3JzXVxyXG4gICAgICAgIH07XHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfTtcclxufVxyXG5cclxuZnVuY3Rpb24gbWFrZU5ld01haW5NYXA8SSwgTz4oXHJcbiAga2V5OiBDb250cm9sc05hbWVzPEk+LFxyXG4gIG9sZE1hcD86IE1hcDxDb250cm9sc05hbWVzPEk+LCBNYWtlQ29udHJvbE9wdGlvbnM+LFxyXG4pOiBNYXA8Q29udHJvbHNOYW1lczxPPiwgTWFrZUNvbnRyb2xPcHRpb25zPiB8IHVuZGVmaW5lZCB7XHJcbiAgaWYgKCFvbGRNYXAgfHwga2V5ID09PSAnbWFpbicpIHtcclxuICAgIHJldHVybiA8TWFwPENvbnRyb2xzTmFtZXM8Tz4sIE1ha2VDb250cm9sT3B0aW9ucz4gfCB1bmRlZmluZWQ+b2xkTWFwO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBpZiAoIW9sZE1hcC5oYXMoa2V5KSAmJiAhb2xkTWFwLmhhcyg8Q29udHJvbHNOYW1lczxJPj5gJHtrZXl9SXRlbXNgKSkge1xyXG4gICAgICByZXR1cm4gbmV3IE1hcDxDb250cm9sc05hbWVzPE8+LCBNYWtlQ29udHJvbE9wdGlvbnM+KFxyXG4gICAgICAgIEFycmF5LmZyb20oXHJcbiAgICAgICAgICBvbGRNYXAuZW50cmllcygpXHJcbiAgICAgICAgKS5maWx0ZXIoXHJcbiAgICAgICAgICBpdGVtID0+IGl0ZW1bMF0gIT09ICdtYWluJyAmJiBpdGVtWzBdICE9PSAnbWFpbkl0ZW1zJ1xyXG4gICAgICAgICkubWFwKFxyXG4gICAgICAgICAgKFtlbnRyeUtleSwgZW50cnlWYWx1ZV0pID0+IFs8Q29udHJvbHNOYW1lczxPPj4oZW50cnlLZXkuc3RhcnRzV2l0aChgJHtrZXl9LmApID8gZW50cnlLZXkucmVwbGFjZShgJHtrZXl9LmAsICcnKSA6IGVudHJ5S2V5KSwgZW50cnlWYWx1ZV1cclxuICAgICAgICApXHJcbiAgICAgICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBmaWx0ZXJQcmVkaWNhdGUgPSBvbGRNYXAuaGFzKDxDb250cm9sc05hbWVzPEk+PidtYWluJykgP1xyXG4gICAgICAgIG9sZE1hcC5oYXMoPENvbnRyb2xzTmFtZXM8ST4+J21haW5JdGVtcycpID9cclxuICAgICAgICAgIChpdGVtOiBbQ29udHJvbHNOYW1lczxJPiwgTWFrZUNvbnRyb2xPcHRpb25zXSkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBwcmUgPSBpdGVtWzBdICE9PSAoa2V5ICsgJ0l0ZW1zJyk7XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtWzBdICE9PSBrZXkgJiYgcHJlICYmIGl0ZW1bMF0gIT09ICdtYWluJyAmJiBpdGVtWzBdICE9PSAnbWFpbkl0ZW1zJztcclxuICAgICAgICAgIH0gOlxyXG4gICAgICAgICAgKGl0ZW06IFtDb250cm9sc05hbWVzPEk+LCBNYWtlQ29udHJvbE9wdGlvbnNdKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByZSA9IGl0ZW1bMF0gIT09IChrZXkgKyAnSXRlbXMnKTtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1bMF0gIT09IGtleSAmJiBrZXlbMF0gIT09IChrZXkgKyAnSXRlbXMnKSAmJiBpdGVtWzBdICE9PSAnbWFpbic7XHJcbiAgICAgICAgICB9IDpcclxuICAgICAgICBvbGRNYXAuaGFzKDxDb250cm9sc05hbWVzPEk+PidtYWluSXRlbXMnKSA/XHJcbiAgICAgICAgICAoaXRlbTogW0NvbnRyb2xzTmFtZXM8ST4sIE1ha2VDb250cm9sT3B0aW9uc10pID0+IHtcclxuICAgICAgICAgICAgY29uc3QgcHJlID0gaXRlbVswXSAhPT0gKGtleSArICdJdGVtcycpO1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlbVswXSAhPT0ga2V5ICYmIHByZSAmJiBpdGVtWzBdICE9PSAnbWFpbkl0ZW1zJztcclxuICAgICAgICAgIH0gOlxyXG4gICAgICAgICAgKGl0ZW06IFtDb250cm9sc05hbWVzPEk+LCBNYWtlQ29udHJvbE9wdGlvbnNdKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHByZSA9IGl0ZW1bMF0gIT09IChrZXkgKyAnSXRlbXMnKTtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZW1bMF0gIT09IGtleSAmJiBwcmU7XHJcbiAgICAgICAgICB9O1xyXG4gICAgICBjb25zdCBuZXdNYWluVmFsaWRhdG9yc0FycmF5OiBbQ29udHJvbHNOYW1lczxPPiwgTWFrZUNvbnRyb2xPcHRpb25zXVtdID0gb2xkTWFwLmhhcyhrZXkpID9cclxuICAgICAgICBvbGRNYXAuaGFzKDxDb250cm9sc05hbWVzPEk+PmAke2tleX1JdGVtc2ApID9cclxuICAgICAgICAgIFtcclxuICAgICAgICAgICAgWzxDb250cm9sc05hbWVzPE8+PidtYWluJywgb2xkTWFwLmdldChrZXkpIV0sXHJcbiAgICAgICAgICAgIFs8Q29udHJvbHNOYW1lczxPPj4nbWFpbkl0ZW1zJywgb2xkTWFwLmdldCg8Q29udHJvbHNOYW1lczxJPj5gJHtrZXl9SXRlbXNgKSFdXHJcbiAgICAgICAgICBdIDpcclxuICAgICAgICAgIFtcclxuICAgICAgICAgICAgWzxDb250cm9sc05hbWVzPE8+PidtYWluJywgb2xkTWFwLmdldChrZXkpIV0sXHJcbiAgICAgICAgICBdIDpcclxuICAgICAgICBvbGRNYXAuaGFzKDxDb250cm9sc05hbWVzPEk+PmAke2tleX1JdGVtc2ApID9cclxuICAgICAgICAgIFtcclxuICAgICAgICAgICAgWzxDb250cm9sc05hbWVzPE8+PidtYWluSXRlbXMnLCBvbGRNYXAuZ2V0KDxDb250cm9sc05hbWVzPEk+PmAke2tleX1JdGVtc2ApIV1cclxuICAgICAgICAgIF0gOlxyXG4gICAgICAgICAgW107XHJcbiAgICAgIGNvbnN0IGZpbHRlcmVkID0gQXJyYXkuZnJvbShcclxuICAgICAgICBvbGRNYXAuZW50cmllcygpXHJcbiAgICAgICkuZmlsdGVyKGZpbHRlclByZWRpY2F0ZSk7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IG5ldyBNYXA8Q29udHJvbHNOYW1lczxPPiwgTWFrZUNvbnRyb2xPcHRpb25zPihbXHJcbiAgICAgICAgLi4ubmV3TWFpblZhbGlkYXRvcnNBcnJheSxcclxuICAgICAgICAuLi5maWx0ZXJlZC5tYXA8W0NvbnRyb2xzTmFtZXM8Tz4sIE1ha2VDb250cm9sT3B0aW9uc10+KFxyXG4gICAgICAgICAgKFtlbnRyeUtleSwgZW50cnlWYWx1ZV0pID0+IFs8Q29udHJvbHNOYW1lczxPPj4oXHJcbiAgICAgICAgICAgIGVudHJ5S2V5LnN0YXJ0c1dpdGgoYCR7a2V5fS5gKSA/XHJcbiAgICAgICAgICAgICAgZW50cnlLZXkucmVwbGFjZShgJHtrZXl9LmAsICcnKSA6XHJcbiAgICAgICAgICAgICAgZW50cnlLZXkuc3RhcnRzV2l0aChgJHtrZXl9SXRlbXMuYCkgP1xyXG4gICAgICAgICAgICAgICAgZW50cnlLZXkucmVwbGFjZShgJHtrZXl9SXRlbXMuYCwgJycpIDpcclxuICAgICAgICAgICAgICAgIGVudHJ5S2V5XHJcbiAgICAgICAgICApLCBlbnRyeVZhbHVlXVxyXG4gICAgICAgIClcclxuICAgICAgXSk7XHJcbiAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9O1xyXG4gIH07XHJcbn1cclxuXHJcbi8qKlxyXG5AZnVuY3Rpb24gbWFrZUZvcm08VD5cclxuICDQpNCw0LHRgNC40YfQvdCw0Y8g0YTRg9C90LrRhtC40Y8g0LTQu9GPINGB0L7Qt9C00LDQvdC40Y8gQW5ndWxhciBSZWFjdGl2ZSBGb3JtLlxyXG7QkiDQvtGC0LvQuNGH0LjQtSDQvtGCINGB0YLQsNC90LTQsNGA0YLQvdC+0LPQviBGb3JtQnVpbGRlciAtINCwINCyINC/0LDQutC10YLQtSBAYW5ndWxhci9mb3Jtcywg0L/RgNC4INGB0L7Qt9C00LDQvdC40Lgg0YTQvtGA0LzRiyDQuNC3INGB0LvQvtC20L3Ri9GFINC+0LHRitC10LrRgtC+0LIsXHJcbtGB0L7RhdGA0LDQvdGP0LXRgtGB0Y8g0LLQu9C+0LbQtdC90L3QvtGB0YLRjCDQutC+0L3RgtGA0L7Qu9C+0LIgLSDQutCw0LbQtNGL0Lkg0LLQu9C+0LbQtdC90L3Ri9C5INC+0LHRitC10LrRgiDQv9GA0LXQstGA0LDRidCw0LXRgtGB0Y8g0LLQviDQstC70L7QttC10L3QvdGD0Y4gRm9ybUdyb3VwLFxyXG4gINC+0LHRi9GH0L3Ri9C1INGB0LLQvtC50YHRgtCy0LAg0L7QsdGK0LXQutGC0L7QsiDRgdGC0LDQvdC+0LLRj9GC0YHRjyBGb3JtQ29udHJvbCAtINCw0LzQuCwg0LAg0LzQsNGB0YHQuNCy0YsgLSBGb3JtQXJyYXkgLSDQvNC4LlxyXG7Qn9GA0Lgg0Y3RgtC+0Lwg0YHQvtC30LTQsNCy0LDQtdC80LDRjyDRhNC+0YDQvNCwINC40LzQtdC10YIg0LHQvtC70LXQtSDRgdGC0YDQvtCz0YPRjiDRgtC40L/QuNC30LDRhtC40Y4uXHJcblxyXG4gINCS0JDQltCd0J4hXHJcbiAgINCn0YLQvtCx0Ysg0LjQt9Cx0LXQttCw0YLRjCDQvtGI0LjQsdC60Lgg0L/QtdGA0LXQv9C+0LvQvdC10L3QuNGPINGB0YLRjdC60LAg0LLRi9C30L7QstC+0LIg0LIg0YDQtdC60YPRgNGB0LjQstC90L7QvCDQv9GA0L7RhtC10YHRgdC1INGB0L7Qt9C00LDQvdC40Y8g0YTQvtGA0LzRiywg0LTQu9GPINC70Y7QsdGL0YU7XHJcbk9ic2VydmFibGUgLSDQt9C90LDRh9C10L3QuNC5KNCyINGCLtGHLiwg0Log0L/RgNC40LzQtdGA0YMsIFN1YmplY3QgKiDQuCBFdmVudEVtaXR0ZXIpINGB0L7QvtGC0LLQtdGC0YHRgtCy0YPRjtGJ0LjQuSDRjdC70LXQvNC10L3RgiDRhNC+0YDQvNGLINC90LUg0YHQvtC30LTQsNC10YLRgdGPLlxyXG4gKiBAcGFyYW0gc291cmNlICDQuNGB0YLQvtGH0L3QuNC6INC00LDQvdC90YvRhSDRgtC40L/QsCBUINC00LvRjyDRgdC+0LfQtNCw0L3QuNGPINGE0L7RgNC80YsuXHJcbiAqIEBwYXJhbSBrZXlzVmFsaWRhdG9yINC+0LHRitC10LrRgiBNYXAg0YEg0LrQvtC90YTQuNCz0YPRgNCw0YbQuNC10Lkg0YHQuNC90YXRgNC+0L3QvdGL0YUg0LLQsNC70LjQtNCw0YLQvtGA0L7QsiDQutC+0L3RgtGA0L7Qu9C+0LIg0YTQvtGA0LzRiy5cclxuICog0JIg0LrQsNGH0LXRgdGC0LLQtSDQutC70Y7Rh9C10Lkg0LzQvtCz0YPRgiDQsdGL0YLRjCDRg9C60LDQt9Cw0L3RiyDRgdC70LXQtNGD0Y7RidC40LUg0LfQvdCw0YfQtdC90LjRjzpcclxuICogIFByb3BlcnR5ZXNLZXlzPFQ+IC0g0YHRgtGA0L7QutC+0LLRi9C1INC60LvRjtGH0Lgg0LIg0YLQuNC/0LUgVCwg0LLQutC70Y7Rh9Cw0Y8g0YHRgtGA0L7QutC+0LLRi9C1INC60LvRjtGH0Lgg0LLRgdC10YUg0LLQu9C+0LbQtdC90L3Ri9GFINGC0LjQv9C+0LIsINGA0LDQt9C00LXQu9C10L3QvdGL0LUgXCIuXCIgLSDRgtC+0YfQutC+0LkuXHJcbiAgICDQndCw0L/RgNC40LzQtdGAINC40LzQtdC10YLRgdGPINGC0LDQutC+0Lkg0YLQuNC/OlxyXG4gICAgYGBgdHNcclxuICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2UgVXNlciB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBmaXJzdG5hbWU6IHN0cmluZztcclxuICAgICAgICAgICAgICAgICAgICAgIGxhc3RuYW1lOiBzdHJpbmc7XHJcbiAgICAgICAgICAgICAgICAgICAgICBwaG9uZTogIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogc3RyaW5nO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBudW1iZXI6IHN0cmluZztcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgIGBgYFxyXG4gICAg0JTQu9GPINGE0L7RgNC80YssINC60L7RgtC+0YDQsNGPINCx0YPQtNC10YIg0YHQvtC30LTQsNC90LAg0LjQtyDQvtCx0YrQtdC60YLQsCBVc2VyINCyINC60L7QvdGE0LjQs9GD0YDQsNGG0LjQuCDQstCw0LvQuNC00LDRgtC+0YDQvtCyINC90LDQt9Cy0LDQvdC40Y8g0LrQvtC90YLRgNC+0LvQvtCyINC80L7QttC90L4g0LHRg9C00LXRgiDRg9C60LDQt9Cw0YLRjCDRgtCw0Lo6XHJcbiAgICBgbGFzdG5hbWVgINC40LvQuGBwaG9uZWAsINC40LvQuGBwaG9uZS5jb2RlYC5cclxuXHJcbiAgICdtYWluJyAtINGB0L/QtdGG0LjQsNC70YzQvdC+0LUg0LfQvdCw0YfQtdC90LjQtSwg0Y/QstC70Y/RjtGJ0LXQtdGB0Y8g0L/RgNC40LfQvdCw0LrQvtC8INGC0L7Qs9C+LCDRh9GC0L4g0LzQsNGB0YHQuNCyINCy0LDQu9C40LTQsNGC0L7RgNC+0LIg0L3QtdC+0LHRhdC+0LTQuNC80L5cclxuICAgINC90LDQt9C90LDRh9C40YLRjCDRgdCw0LzQvtC80YMg0L7QsdGK0LXQutGC0YMg0YTQvtGA0LzRiywg0LAg0L3QtSDQstC70L7QttC10L3Ri9C8INC60L7QvdGC0YDQvtC70LDQvC5cclxuXHJcbiAgICdtYWluSXRlbXMnIC0g0LjRgdC/0L7Qu9GM0LfRg9C10YLRgdGPINGC0L7Qu9GM0LrQviDQtdGB0LvQuCBzb3VyY2Ug0Y/QstC70Y/QtdGC0YHRjyDQvNCw0YHRgdC40LLQvtC8LiDQodC/0LXRhtC40LDQu9GM0L3QvtC1INC30L3QsNGH0LXQvdC40LUsINGP0LLQu9GP0Y7RidC10LXRgdGPINC/0YDQuNC30L3QsNC60L7QvCDRgtC+0LPQvixcclxuICDRh9GC0L4g0LzQsNGB0YHQuNCyINCy0LDQu9C40LTQsNGC0L7RgNC+0LIg0L3QtdC+0LHRhdC+0LTQuNC80L4g0L3QsNC30L3QsNGH0LjRgtGMINC00LvRjyDQstGB0LXRhSDRjdC70LXQvNC10L3RgtC+0LIg0LzQsNGB0YHQuNCy0LAgRm9ybUFycmF5LlxyXG4gKiBAcGFyYW0gYXN5bmNLZXlzVmFsaWRhdG9yINC+0LHRitC10LrRgiBNYXAsINCw0L3QsNC70L7Qs9C40YfQvdGL0Lkga2V5c1ZhbGlkYXRvciwg0L3QviDQtNC70Y8g0LDRgdC40L3RhdGA0L7QvdC90YvRhSDQstCw0LvQuNC00LDRgtC+0YDQvtCyXHJcbiAqIEByZXR1cm5zINC+0LHRitC10LrRgiDRgtC40L/QuNC30LjRgNC+0LLQsNC90L3QvtC5INGE0L7RgNC80YsgLSBGb3JtR3JvdXAsIEZvcm1BcnJheSDQuNC70LggRm9ybUNvbnRyb2wg0LIg0LfQsNCy0LjRgdC40LzQvtGB0YLQuCDQvtGCINGC0LjQv9CwINC30L3QsNGH0LXQvdC40Y8gc291cmNlLlxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VGb3JtPFQgZXh0ZW5kcyB1bmtub3duPihcclxuICBzb3VyY2U6IFQsXHJcbiAgb3B0aW9ucz86IE1hcDxDb250cm9sc05hbWVzPFQ+LCBNYWtlQ29udHJvbE9wdGlvbnM+LFxyXG4pOiBTY2FuRm9ybVR5cGU8VD4ge1xyXG4gIGNvbnN0IGZvcm0gPSAhIXNvdXJjZSAmJiAodHlwZW9mIHNvdXJjZSA9PT0gJ29iamVjdCcgfHwgdHlwZW9mIHNvdXJjZSA9PT0gJ2Z1bmN0aW9uJykgP1xyXG4gICAgc291cmNlIGluc3RhbmNlb2YgQXJyYXk8dW5rbm93bj4gP1xyXG4gICAgICBtYWtlQXJyYXkoc291cmNlLCBvcHRpb25zKSA6XHJcbiAgICAgIG1ha2VHcm91cCg8b2JqZWN0PnNvdXJjZSwgJ21haW4nLCBvcHRpb25zKSA6XHJcbiAgICBtYWtlQ29udHJvbCg8dW5kZWZpbmVkIHwgbnVsbCB8IG51bWJlciB8IGJvb2xlYW4gfCBzeW1ib2wgfCBzdHJpbmc+c291cmNlLCBvcHRpb25zKTtcclxuICByZXR1cm4gPFNjYW5Gb3JtVHlwZTxUPj5mb3JtO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gbGlmdEVycm9ycyhjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpOiBWYWxpZGF0aW9uRXJyb3JzIHwgbnVsbCB7XHJcbiAgaWYgKGNvbnRyb2wgaW5zdGFuY2VvZiBGb3JtQ29udHJvbCkge1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfSBlbHNlIHtcclxuICAgIGNvbnN0IGFsbENvbnRyb2xzID0gY29udHJvbCBpbnN0YW5jZW9mIEZvcm1Hcm91cCA/XHJcbiAgICAgIE9iamVjdC52YWx1ZXMoY29udHJvbC5jb250cm9scykgOlxyXG4gICAgICBjb250cm9sIGluc3RhbmNlb2YgRm9ybUFycmF5ID9cclxuICAgICAgICBjb250cm9sLmNvbnRyb2xzIDpcclxuICAgICAgICBbXTtcclxuICAgIGNvbnN0IGludmFsaWRDb250cm9scyA9IGFsbENvbnRyb2xzLmZpbHRlcihjb250cm9sID0+IGNvbnRyb2wuc3RhdHVzID09PSAnSU5WQUxJRCcpO1xyXG4gICAgcmV0dXJuIGludmFsaWRDb250cm9scy5sZW5ndGggPT09IDAgPyBudWxsIDogaW52YWxpZENvbnRyb2xzLnJlZHVjZShcclxuICAgICAgKGFjY3VtdWxhdG9yLCBjdXJyZW50KSA9PiB7XHJcbiAgICAgICAgaWYgKGN1cnJlbnQuZXJyb3JzKSB7XHJcbiAgICAgICAgICBhZGRWYWxpZGF0aW9uRXJyb3JzKGN1cnJlbnQuZXJyb3JzLCBhY2N1bXVsYXRvcik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gYWNjdW11bGF0b3I7XHJcbiAgICAgIH0sIDxWYWxpZGF0aW9uRXJyb3JzPnt9XHJcbiAgICApO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxpZnRWYWxpZGF0aW9uRXJyb3JzKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsIHtcclxuICBjb25zdCBhbGxDb250cm9scyA9IGNvbnRyb2wgaW5zdGFuY2VvZiBGb3JtR3JvdXAgP1xyXG4gICAgT2JqZWN0LnZhbHVlcyhjb250cm9sLmNvbnRyb2xzKSA6XHJcbiAgICBjb250cm9sIGluc3RhbmNlb2YgRm9ybUFycmF5ID9cclxuICAgICAgY29udHJvbC5jb250cm9scyA6XHJcbiAgICAgIFtdO1xyXG4gIGNvbnN0IGludmFsaWRDb250cm9scyA9IGFsbENvbnRyb2xzLmZpbHRlcihjb250cm9sID0+IGNvbnRyb2wuc3RhdHVzID09PSAnSU5WQUxJRCcpO1xyXG4gIGNvbnN0IGVycm9yczogVmFsaWRhdGlvbkVycm9ycyA9IGludmFsaWRDb250cm9scy5sZW5ndGggPT09IDAgPyB7fSA6IGludmFsaWRDb250cm9scy5yZWR1Y2UoXHJcbiAgICAoYWNjdW11bGF0b3IsIGN1cnJlbnQpID0+IHtcclxuICAgICAgaWYgKGN1cnJlbnQuZXJyb3JzKSB7XHJcbiAgICAgICAgYWRkVmFsaWRhdGlvbkVycm9ycyhjdXJyZW50LmVycm9ycywgYWNjdW11bGF0b3IpO1xyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCBpbm5lckVycm9ycyA9IGxpZnRWYWxpZGF0aW9uRXJyb3JzKGN1cnJlbnQpO1xyXG4gICAgICBpZiAoaW5uZXJFcnJvcnMpIHtcclxuICAgICAgICBhZGRWYWxpZGF0aW9uRXJyb3JzKGlubmVyRXJyb3JzLCBhY2N1bXVsYXRvcik7XHJcbiAgICAgIH07XHJcbiAgICAgIHJldHVybiBhY2N1bXVsYXRvcjtcclxuICAgIH0sIDxWYWxpZGF0aW9uRXJyb3JzPnt9XHJcbiAgKTtcclxuICByZXR1cm4gT2JqZWN0LnZhbHVlcyhlcnJvcnMpLmxlbmd0aCA9PT0gMCA/IG51bGwgOiBlcnJvcnM7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBhZGRWYWxpZGF0aW9uRXJyb3JzKGFkZGl0aW9uRXJyb3JzOiBWYWxpZGF0aW9uRXJyb3JzLCBjdXJyZW50RXJyb3JzOiBWYWxpZGF0aW9uRXJyb3JzKSB7XHJcbiAgT2JqZWN0LmVudHJpZXMoYWRkaXRpb25FcnJvcnMpLmZvckVhY2goXHJcbiAgICBlbnRyeSA9PiBjdXJyZW50RXJyb3JzW2VudHJ5WzBdXSA9IGVudHJ5WzFdXHJcbiAgKTtcclxufVxyXG5cclxuZnVuY3Rpb24gbWFrZUNvbnRyb2w8VCBleHRlbmRzIHVuZGVmaW5lZCB8IG51bGwgfCBudW1iZXIgfCBib29sZWFuIHwgc3ltYm9sIHwgc3RyaW5nPihcclxuICBzb3VyY2U6IFQgfCBGb3JtQ29udHJvbDxUIHwgbnVsbD4sXHJcbiAgb3B0aW9ucz86IE1hcDxDb250cm9sc05hbWVzPFQ+LCBNYWtlQ29udHJvbE9wdGlvbnM+XHJcbik6IEZvcm1Db250cm9sPFQgfCBudWxsPiB7XHJcbiAgY29uc3QgY29udHJvbE9wdGlvbnMgPSBnZXRWYWxpZGF0b3JzT3JOdWxsKDxDb250cm9sc05hbWVzPFQ+PidtYWluJywgb3B0aW9ucywgZmFsc2UpO1xyXG4gIGNvbnN0IHJlc3VsdCA9IHNvdXJjZSBpbnN0YW5jZW9mIEZvcm1Db250cm9sID9cclxuICAgIHNvdXJjZSA6XHJcbiAgICBuZXcgRm9ybUNvbnRyb2w8VCB8IG51bGw+KFxyXG4gICAgICAhIXNvdXJjZSAmJiB0eXBlb2Ygc291cmNlID09ICdzdHJpbmcnICYmIChzb3VyY2UuaW5jbHVkZXMoJzAwMDEtMDEtMDEnKSB8fCBzb3VyY2UuaW5jbHVkZXMoJzE5NzAtMDEtMDEnKSkgPyBudWxsIDogc291cmNlXHJcbiAgICAgICxcclxuICAgICAge1xyXG4gICAgICAgIHZhbGlkYXRvcnM6IGNvbnRyb2xPcHRpb25zPy52YWxpZGF0b3JzLFxyXG4gICAgICAgIGFzeW5jVmFsaWRhdG9yczogY29udHJvbE9wdGlvbnM/LmFzeW5jVmFsaWRhdG9ycyxcclxuICAgICAgICB1cGRhdGVPbjogY29udHJvbE9wdGlvbnM/LnVwZGF0ZU9uLFxyXG4gICAgICAgIG5vbk51bGxhYmxlOiBjb250cm9sT3B0aW9ucz8ubm9uTnVsbGFibGVcclxuICAgICAgfSxcclxuICAgICk7XHJcbiAgaWYgKGNvbnRyb2xPcHRpb25zPy5kaXNhYmxlZCkge1xyXG4gICAgcmVzdWx0LmRpc2FibGUoKTtcclxuICB9O1xyXG4gIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG1ha2VHcm91cDxUIGV4dGVuZHMgb2JqZWN0ID0gb2JqZWN0PihcclxuICBzb3VyY2U6IFQgfCBGb3JtR3JvdXBUeXBlPFQ+LFxyXG4gIGludGVybmFsS2V5OiBDb250cm9sc05hbWVzPFQ+LFxyXG4gIG9wdGlvbnM/OiBNYXA8Q29udHJvbHNOYW1lczxUPiwgTWFrZUNvbnRyb2xPcHRpb25zPlxyXG4pOiBGb3JtR3JvdXBUeXBlPFQ+IHtcclxuICBjb25zdCBjb250cm9sT3B0aW9ucyA9IGdldFZhbGlkYXRvcnNPck51bGwoaW50ZXJuYWxLZXksIG9wdGlvbnMsIGZhbHNlKTtcclxuICBjb25zdCByZXN1bHQgPSBzb3VyY2UgaW5zdGFuY2VvZiBGb3JtR3JvdXA8eyBbSyBpbiBTdHJpbmdLZXlzPFQ+XTogU2NhbkZvcm1UeXBlPFRbS10+OyB9PiA/XHJcbiAgICBzb3VyY2UgOlxyXG4gICAgKDxbU3RyaW5nS2V5czxUPiwgVFtTdHJpbmdLZXlzPFQ+XV1bXT5PYmplY3QuZW50cmllcyhzb3VyY2UpKS5yZWR1Y2UoXHJcbiAgICAgIChhY2N1bXVsYXRvcjogRm9ybUdyb3VwLCBlbnRyeTogW1N0cmluZ0tleXM8VD4sIFRbU3RyaW5nS2V5czxUPl1dKSA9PiB7XHJcbiAgICAgICAgY29uc3Qga2V5ID0gZW50cnlbMF07XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSBlbnRyeVsxXTtcclxuICAgICAgICBpZiAoISh2YWx1ZSBpbnN0YW5jZW9mIE9ic2VydmFibGUpKSB7XHJcbiAgICAgICAgICBhY2N1bXVsYXRvci5hZGRDb250cm9sKFxyXG4gICAgICAgICAgICBrZXksXHJcbiAgICAgICAgICAgICEhdmFsdWUgJiYgKFxyXG4gICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgRm9ybUdyb3VwIHx8IHZhbHVlIGluc3RhbmNlb2YgRm9ybUFycmF5IHx8IHZhbHVlIGluc3RhbmNlb2YgRm9ybUNvbnRyb2xcclxuICAgICAgICAgICAgKSA/XHJcbiAgICAgICAgICAgICAgPFNjYW5Gb3JtVHlwZTxUW1N0cmluZ0tleXM8VD5dPj52YWx1ZSA6XHJcbiAgICAgICAgICAgICAgbWFrZUZvcm08VFtTdHJpbmdLZXlzPFQ+XT4oXHJcbiAgICAgICAgICAgICAgICB2YWx1ZSxcclxuICAgICAgICAgICAgICAgIG1ha2VOZXdNYWluTWFwPFQsIFRbU3RyaW5nS2V5czxUPl0+KDxDb250cm9sc05hbWVzPFQ+PmtleSwgb3B0aW9ucyksXHJcbiAgICAgICAgICAgICAgKVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiA8Rm9ybUdyb3VwVHlwZTxUPj5hY2N1bXVsYXRvcjtcclxuICAgICAgfSwgbmV3IEZvcm1Hcm91cDx7IFtLIGluIFN0cmluZ0tleXM8VD5dOiBTY2FuRm9ybVR5cGU8VFtLXT47IH0+KDx7IFtLIGluIFN0cmluZ0tleXM8VD5dOiBTY2FuRm9ybVR5cGU8VFtLXT47IH0+e30sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgdmFsaWRhdG9yczogY29udHJvbE9wdGlvbnM/LnZhbGlkYXRvcnMsXHJcbiAgICAgICAgICBhc3luY1ZhbGlkYXRvcnM6IGNvbnRyb2xPcHRpb25zPy5hc3luY1ZhbGlkYXRvcnMsXHJcbiAgICAgICAgICB1cGRhdGVPbjogY29udHJvbE9wdGlvbnM/LnVwZGF0ZU9uLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIClcclxuICAgICk7XHJcbiAgaWYgKGNvbnRyb2xPcHRpb25zPy5kaXNhYmxlZCkge1xyXG4gICAgcmVzdWx0LmRpc2FibGUoKTtcclxuICB9O1xyXG4gIHJldHVybiByZXN1bHQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG1ha2VBcnJheTxUIGV4dGVuZHMgQXJyYXk8dW5rbm93bj4sIEUgPSBUIGV4dGVuZHMgQXJyYXk8aW5mZXIgVT4gPyBVIDogbmV2ZXI+KFxyXG4gIHNvdXJjZTogRVtdIHwgRm9ybUFycmF5PFNjYW5Gb3JtVHlwZTxFPj4sXHJcbiAgb3B0aW9ucz86IE1hcDxDb250cm9sc05hbWVzPFQ+LCBNYWtlQ29udHJvbE9wdGlvbnM+XHJcbik6IEZvcm1BcnJheTxTY2FuRm9ybVR5cGU8RT4+IHtcclxuICBjb25zdCBjb250cm9sT3B0aW9ucyA9IGdldFZhbGlkYXRvcnNPck51bGwoPENvbnRyb2xzTmFtZXM8VD4+J21haW4nLCBvcHRpb25zLCBmYWxzZSk7XHJcbiAgY29uc3QgcmVzdWx0ID0gc291cmNlIGluc3RhbmNlb2YgRm9ybUFycmF5ID9cclxuICAgIHNvdXJjZSA6XHJcbiAgICBuZXcgRm9ybUFycmF5KFxyXG4gICAgICBzb3VyY2UubWFwKFxyXG4gICAgICAgIChpdGVtOiBFKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBpdGVtRm9ybSA9IG1ha2VGb3JtKFxyXG4gICAgICAgICAgICBpdGVtLFxyXG4gICAgICAgICAgICBtYWtlTmV3TWFpbk1hcDxULCBFPig8Q29udHJvbHNOYW1lczxUPj4nbWFpbkl0ZW1zJywgb3B0aW9ucyksXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgcmV0dXJuIGl0ZW1Gb3JtO1xyXG4gICAgICAgIH0pLFxyXG4gICAgICB7XHJcbiAgICAgICAgdmFsaWRhdG9yczogY29udHJvbE9wdGlvbnM/LnZhbGlkYXRvcnMsXHJcbiAgICAgICAgYXN5bmNWYWxpZGF0b3JzOiBjb250cm9sT3B0aW9ucz8uYXN5bmNWYWxpZGF0b3JzLFxyXG4gICAgICAgIHVwZGF0ZU9uOiBjb250cm9sT3B0aW9ucz8udXBkYXRlT25cclxuICAgICAgfVxyXG4gICAgKTtcclxuICBpZiAoY29udHJvbE9wdGlvbnM/LmRpc2FibGVkKSB7XHJcbiAgICByZXN1bHQuZGlzYWJsZSgpO1xyXG4gIH07XHJcbiAgcmV0dXJuIHJlc3VsdDtcclxufSJdfQ==