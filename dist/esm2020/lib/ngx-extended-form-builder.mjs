import { FormGroup, FormArray, FormControl } from "@angular/forms";
import { Observable } from "rxjs";
function getValidatorsOrNull(key, keysValidator, addLift = false) {
    const result = keysValidator && keysValidator.has(key) ? keysValidator.get(key) : null;
    if (addLift) {
        if (result && Array.isArray(result)) {
            result.push(liftErrors);
            return result;
        }
        else {
            return result ? result : [liftErrors];
        }
    }
    else {
        return result;
    }
    ;
}
function makeFormGroup(source, internalKey, keysValidator, asyncKeysValidator) {
    return source instanceof (FormGroup) ?
        source :
        Object.entries(source).reduce((accumulator, entry) => {
            const key = entry[0];
            const value = entry[1];
            if (!(value instanceof Observable)) {
                accumulator.addControl(key, !!value && (value instanceof FormGroup || value instanceof FormArray || value instanceof (FormControl)) ?
                    value :
                    makeForm(value, makeNewMainFormValidatorsMap(key, keysValidator), makeNewMainFormValidatorsMap(key, asyncKeysValidator)));
            }
            ;
            return accumulator;
        }, new FormGroup({}, getValidatorsOrNull(internalKey, keysValidator, true), getValidatorsOrNull(internalKey, asyncKeysValidator, false)));
}
function makeNewMainFormValidatorsMap(key, oldMap) {
    if (!oldMap || key === 'mainFormValidators' || key === 'mainFormValidatorsItems') {
        return oldMap;
    }
    else {
        if (!oldMap.has(key) && !oldMap.has(`${key}Items`)) {
            return new Map(Array.from(oldMap.entries()).filter(item => item[0] !== 'mainFormValidators' && item[0] !== 'mainFormValidatorsItems').map(([entryKey, entryValue]) => [entryKey.startsWith(`${key}.`) ? entryKey.replace(`${key}.`, '') : entryKey, entryValue]));
        }
        else {
            const filterPredicate = oldMap.has('mainFormValidators') ?
                oldMap.has('mainFormValidatorsItems') ?
                    (item) => item[0] !== key && item[0] !== 'mainFormValidators' && item[0] !== 'mainFormValidatorsItems' :
                    (item) => item[0] !== key && item[0] !== 'mainFormValidators' :
                oldMap.has('mainFormValidatorsItems') ?
                    (item) => item[0] !== key && item[0] !== 'mainFormValidatorsItems' :
                    (item) => item[0] !== key;
            const newMainValidatorsArray = oldMap.has(key) ?
                oldMap.has(`${key}Items`) ?
                    [
                        ['mainFormValidators', oldMap.get(key)],
                        ['mainFormValidatorsItems', oldMap.get(`${key}Items`)]
                    ] :
                    [
                        ['mainFormValidators', oldMap.get(key)],
                    ] :
                oldMap.has(`${key}Items`) ?
                    [
                        ['mainFormValidatorsItems', oldMap.get(`${key}Items`)]
                    ] :
                    [];
            return new Map([
                ...newMainValidatorsArray,
                ...Array.from(oldMap.entries()).filter(filterPredicate).map(([entryKey, entryValue]) => [entryKey.startsWith(`${key}.`) ? entryKey.replace(`${key}.`, '') : entryKey, entryValue])
            ]);
        }
        ;
    }
    ;
}
export function makeForm(source, keysValidator, asyncKeysValidator) {
    const form = !!source && (typeof source === 'object' || typeof source === 'function') ?
        source instanceof (Array) ?
            new FormArray(source.map((item) => {
                const itemForm = makeForm(item, makeNewMainFormValidatorsMap('mainFormValidatorsItems', keysValidator), makeNewMainFormValidatorsMap('mainFormValidatorsItems', asyncKeysValidator));
                return itemForm;
            }), getValidatorsOrNull('mainFormValidators', keysValidator, true), getValidatorsOrNull('mainFormValidators', asyncKeysValidator, false)) :
            makeFormGroup(source, 'mainFormValidators', keysValidator, asyncKeysValidator) :
        new FormControl(!!source && typeof source == 'string' && (source.includes('0001-01-01') || source.includes('1970-01-01')) ? null : source, getValidatorsOrNull('mainFormValidators', keysValidator, false), getValidatorsOrNull('mainFormValidators', asyncKeysValidator, false));
    return form;
}
;
function liftErrors(control) {
    if (control instanceof FormControl) {
        return null;
    }
    else {
        const allControls = control instanceof FormGroup ?
            Object.values(control.controls) :
            control instanceof FormArray ?
                control.controls :
                [];
        const invalidControls = allControls.filter(control => control.status === 'INVALID');
        return invalidControls.length === 0 ? null : invalidControls.reduce((accumulator, current) => {
            if (current.errors) {
                addValidationErrors(current.errors, accumulator);
            }
            ;
            return accumulator;
        }, {});
    }
}
export function liftValidationErrors(control) {
    const allControls = control instanceof FormGroup ?
        Object.values(control.controls) :
        control instanceof FormArray ?
            control.controls :
            [];
    const invalidControls = allControls.filter(control => control.status === 'INVALID');
    const errors = invalidControls.length === 0 ? {} : invalidControls.reduce((accumulator, current) => {
        if (current.errors) {
            addValidationErrors(current.errors, accumulator);
        }
        ;
        const innerErrors = liftValidationErrors(current);
        if (innerErrors) {
            addValidationErrors(innerErrors, accumulator);
        }
        ;
        return accumulator;
    }, {});
    return Object.values(errors).length === 0 ? null : errors;
}
;
function addValidationErrors(additionErrors, currentErrors) {
    Object.entries(additionErrors).forEach(entry => currentErrors[entry[0]] = entry[1]);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWV4dGVuZGVkLWZvcm0tYnVpbGRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3Byb2plY3RzL25neC1leHRlbmRlZC1mb3JtLWJ1aWxkZXIvc3JjL2xpYi9uZ3gtZXh0ZW5kZWQtZm9ybS1idWlsZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRW5FLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFzQmxDLFNBQVMsbUJBQW1CLENBQzFCLEdBQVcsRUFBRSxhQUE4QixFQUFFLFVBQW1CLEtBQUs7SUFFckUsTUFBTSxNQUFNLEdBQUcsYUFBYSxJQUFJLGFBQWEsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUN2RixJQUFJLE9BQU8sRUFBRTtRQUNYLElBQUksTUFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7WUFDbEIsTUFBTyxDQUFDLElBQUksQ0FBZSxVQUFVLENBQUMsQ0FBQztZQUN4RCxPQUFXLE1BQU0sQ0FBQztTQUNuQjthQUFNO1lBQ0wsT0FBTyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUksQ0FBRSxVQUFVLENBQUUsQ0FBQztTQUM1QztLQUNGO1NBQU07UUFDTCxPQUFPLE1BQU0sQ0FBQztLQUNmO0lBQUEsQ0FBQztBQUNKLENBQUM7QUFFRCxTQUFTLGFBQWEsQ0FDcEIsTUFBUyxFQUNULFdBQW1CLEVBQ25CLGFBQWlELEVBQ2pELGtCQUEyRDtJQUUzRCxPQUFPLE1BQU0sYUFBWSxTQUFzRCxDQUFBLENBQUMsQ0FBQztRQUMvRSxNQUFNLENBQUMsQ0FBQztRQUNrRCxNQUFNLENBQUMsT0FB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YSxDQUFFLEtBQUssQ0FBRSxDQUFDLENBQUUsQ0FBRSxHQUFHLEtBQUssQ0FBRSxDQUFDLENBQUUsQ0FDbEQsQ0FBQztBQUNKLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGb3JtR3JvdXAsIEZvcm1BcnJheSwgRm9ybUNvbnRyb2wgfSBmcm9tIFwiQGFuZ3VsYXIvZm9ybXNcIjtcbmltcG9ydCB0eXBlIHsgVmFsaWRhdG9yRm4sIFZhbGlkYXRpb25FcnJvcnMsIEFzeW5jVmFsaWRhdG9yRm4sIEFic3RyYWN0Q29udHJvbCB9IGZyb20gXCJAYW5ndWxhci9mb3Jtc1wiO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gXCJyeGpzXCI7XG5cbnR5cGUgQXJyYXlFbGVtZW50PFQ+ID0gVCBleHRlbmRzIEFycmF5PGluZmVyIFU+ID8gVSA6IG5ldmVyO1xuXG50eXBlIFNjYW5Gb3JtVHlwZTxUPiA9IFQgZXh0ZW5kcyBGb3JtR3JvdXA8aW5mZXIgVT4gP1xuICBTY2FuRm9ybVR5cGU8VT4gOlxuICBUIGV4dGVuZHMgRm9ybUFycmF5PGluZmVyIFU+ID9cbiAgU2NhbkZvcm1UeXBlPFU+IDpcbiAgVCBleHRlbmRzIEZvcm1Db250cm9sPGluZmVyIFU+ID9cbiAgU2NhbkZvcm1UeXBlPFU+IDpcbiAgVCBleHRlbmRzIEFycmF5PGluZmVyIFU+ID9cbiAgRm9ybUFycmF5PFNjYW5Gb3JtVHlwZTxVPj4gOlxuICBUIGV4dGVuZHMgbnVsbCB8IHVuZGVmaW5lZCA/XG4gIG5ldmVyIDpcbiAgVCBleHRlbmRzIChzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgc3ltYm9sKSA/XG4gIEZvcm1Db250cm9sPFQgfCBudWxsPiA6XG4gIEZvcm1Hcm91cDx7IFsgSyBpbiBrZXlvZiBUIF06IFNjYW5Gb3JtVHlwZTxUWyBLIF0+OyB9PjtcblxudHlwZSBGb3JtR3JvdXBUeXBlPFQ+ID0gRm9ybUdyb3VwPHsgWyBLIGluIGtleW9mIFQgXTogU2NhbkZvcm1UeXBlPFRbIEsgXT47IH0+O1xuXG50eXBlIElubmVyVHlwZTxULCBLIGV4dGVuZHMga2V5b2YgVD4gPSBUWyBLIF07XG5cbmZ1bmN0aW9uIGdldFZhbGlkYXRvcnNPck51bGw8VCBleHRlbmRzIFZhbGlkYXRvckZuW10gfCBBc3luY1ZhbGlkYXRvckZuW10gfCBudWxsPihcbiAga2V5OiBzdHJpbmcsIGtleXNWYWxpZGF0b3I/OiBNYXA8c3RyaW5nLCBUPiwgYWRkTGlmdDogYm9vbGVhbiA9IGZhbHNlXG4pOiBUIHwgdW5kZWZpbmVkIHwgbnVsbCB7XG4gIGNvbnN0IHJlc3VsdCA9IGtleXNWYWxpZGF0b3IgJiYga2V5c1ZhbGlkYXRvci5oYXMoa2V5KSA/IGtleXNWYWxpZGF0b3IuZ2V0KGtleSkgOiBudWxsO1xuICBpZiAoYWRkTGlmdCkge1xuICAgIGlmIChyZXN1bHQgJiYgQXJyYXkuaXNBcnJheShyZXN1bHQpKSB7XG4gICAgICAoPFZhbGlkYXRvckZuW10+IHJlc3VsdCkucHVzaCg8VmFsaWRhdG9yRm4+IGxpZnRFcnJvcnMpO1xuICAgICAgcmV0dXJuIDxUPiByZXN1bHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiByZXN1bHQgPyByZXN1bHQgOiA8VD5bIGxpZnRFcnJvcnMgXTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcbn1cblxuZnVuY3Rpb24gbWFrZUZvcm1Hcm91cDxUPihcbiAgc291cmNlOiBULFxuICBpbnRlcm5hbEtleTogc3RyaW5nLFxuICBrZXlzVmFsaWRhdG9yPzogTWFwPHN0cmluZywgVmFsaWRhdG9yRm5bXSB8IG51bGw+LFxuICBhc3luY0tleXNWYWxpZGF0b3I/OiBNYXA8c3RyaW5nLCBBc3luY1ZhbGlkYXRvckZuW10gfCBudWxsPlxuKTogRm9ybUdyb3VwVHlwZTxUPiB7XG4gIHJldHVybiBzb3VyY2UgaW5zdGFuY2VvZiBGb3JtR3JvdXA8eyBbIEsgaW4ga2V5b2YgVCBdOiBTY2FuRm9ybVR5cGU8VFsgSyBdPjsgfT4gP1xuICAgIHNvdXJjZSA6XG4gICAgKDxbIHN0cmluZyAmIGtleW9mIFQsIElubmVyVHlwZTxULCBzdHJpbmcgJiBrZXlvZiBUPiBdW10+IE9iamVjdC5lbnRyaWVzKHNvdXJjZSkpLnJlZHVjZShcbiAgICAgIChhY2N1bXVsYXRvcjogRm9ybUdyb3VwLCBlbnRyeTogWyBzdHJpbmcgJiBrZXlvZiBULCBJbm5lclR5cGU8VCwgc3RyaW5nICYga2V5b2YgVD4gXSkgPT4ge1xuICAgICAgICBjb25zdCBrZXkgPSBlbnRyeVsgMCBdO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGVudHJ5WyAxIF07XG4gICAgICAgIGlmICghKHZhbHVlIGluc3RhbmNlb2YgT2JzZXJ2YWJsZSkpIHtcbiAgICAgICAgICBhY2N1bXVsYXRvci5hZGRDb250cm9sKFxuICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgISF2YWx1ZSAmJiAoXG4gICAgICAgICAgICAgIHZhbHVlIGluc3RhbmNlb2YgRm9ybUdyb3VwIHx8IHZhbHVlIGluc3RhbmNlb2YgRm9ybUFycmF5IHx8IHZhbHVlIGluc3RhbmNlb2YgRm9ybUNvbnRyb2w8SW5uZXJUeXBlPFQsIHN0cmluZyAmIGtleW9mIFQ+IHwgbnVsbD5cbiAgICAgICAgICAgICkgP1xuICAgICAgICAgICAgICA8U2NhbkZvcm1UeXBlPElubmVyVHlwZTxULCBzdHJpbmcgJiBrZXlvZiBUPj4+IDx1bmtub3duPiB2YWx1ZSA6XG4gICAgICAgICAgICAgIG1ha2VGb3JtPElubmVyVHlwZTxULCBzdHJpbmcgJiBrZXlvZiBUPj4oXG4gICAgICAgICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgICAgICAgbWFrZU5ld01haW5Gb3JtVmFsaWRhdG9yc01hcChrZXksIGtleXNWYWxpZGF0b3IpLFxuICAgICAgICAgICAgICAgIG1ha2VOZXdNYWluRm9ybVZhbGlkYXRvcnNNYXAoa2V5LCBhc3luY0tleXNWYWxpZGF0b3IpLFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIDxGb3JtR3JvdXBUeXBlPFQ+PiBhY2N1bXVsYXRvcjtcbiAgICAgIH0sIG5ldyBGb3JtR3JvdXA8eyBbIEsgaW4ga2V5b2YgVCBdOiBTY2FuRm9ybVR5cGU8VFsgSyBdPjsgfT4oPHsgWyBLIGluIGtleW9mIFQgXTogU2NhbkZvcm1UeXBlPFRbIEsgXT47IH0+IHt9LFxuICAgICAgICBnZXRWYWxpZGF0b3JzT3JOdWxsKGludGVybmFsS2V5LCBrZXlzVmFsaWRhdG9yLCB0cnVlKSxcbiAgICAgICAgZ2V0VmFsaWRhdG9yc09yTnVsbChpbnRlcm5hbEtleSwgYXN5bmNLZXlzVmFsaWRhdG9yLCBmYWxzZSlcbiAgICAgIClcbiAgICApO1xufVxuXG5mdW5jdGlvbiBtYWtlTmV3TWFpbkZvcm1WYWxpZGF0b3JzTWFwPFQgZXh0ZW5kcyBWYWxpZGF0b3JGbltdIHwgQXN5bmNWYWxpZGF0b3JGbltdIHwgbnVsbD4oXG4gIGtleTogc3RyaW5nLCBvbGRNYXA/OiBNYXA8c3RyaW5nLCBUPixcbik6IE1hcDxzdHJpbmcsIFQ+IHwgdW5kZWZpbmVkIHtcbiAgaWYgKCFvbGRNYXAgfHwga2V5ID09PSAnbWFpbkZvcm1WYWxpZGF0b3JzJyB8fCBrZXkgPT09ICdtYWluRm9ybVZhbGlkYXRvcnNJdGVtcycpIHtcbiAgICByZXR1cm4gb2xkTWFwO1xuICB9IGVsc2Uge1xuICAgIGlmICghb2xkTWFwLmhhcyhrZXkpICYmICFvbGRNYXAuaGFzKGAkeyBrZXkgfUl0ZW1zYCkpIHtcbiAgICAgIHJldHVybiBuZXcgTWFwPHN0cmluZywgVD4oXG4gICAgICAgIEFycmF5LmZyb20oXG4gICAgICAgICAgb2xkTWFwLmVudHJpZXMoKVxuICAgICAgICApLmZpbHRlcihcbiAgICAgICAgICBpdGVtID0+IGl0ZW1bIDAgXSAhPT0gJ21haW5Gb3JtVmFsaWRhdG9ycycgJiYgaXRlbVsgMCBdICE9PSAnbWFpbkZvcm1WYWxpZGF0b3JzSXRlbXMnXG4gICAgICAgICkubWFwKFxuICAgICAgICAgIChbIGVudHJ5S2V5LCBlbnRyeVZhbHVlIF0pID0+IFsgZW50cnlLZXkuc3RhcnRzV2l0aChgJHsga2V5IH0uYCkgPyBlbnRyeUtleS5yZXBsYWNlKGAkeyBrZXkgfS5gLCAnJykgOiBlbnRyeUtleSwgZW50cnlWYWx1ZSBdXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGZpbHRlclByZWRpY2F0ZSA9IG9sZE1hcC5oYXMoJ21haW5Gb3JtVmFsaWRhdG9ycycpID9cbiAgICAgICAgb2xkTWFwLmhhcygnbWFpbkZvcm1WYWxpZGF0b3JzSXRlbXMnKSA/XG4gICAgICAgICAgKGl0ZW06IFsgc3RyaW5nLCBUIF0pID0+IGl0ZW1bIDAgXSAhPT0ga2V5ICYmIGl0ZW1bIDAgXSAhPT0gJ21haW5Gb3JtVmFsaWRhdG9ycycgJiYgaXRlbVsgMCBdICE9PSAnbWFpbkZvcm1WYWxpZGF0b3JzSXRlbXMnIDpcbiAgICAgICAgICAoaXRlbTogWyBzdHJpbmcsIFQgXSkgPT4gaXRlbVsgMCBdICE9PSBrZXkgJiYgaXRlbVsgMCBdICE9PSAnbWFpbkZvcm1WYWxpZGF0b3JzJyA6XG4gICAgICAgIG9sZE1hcC5oYXMoJ21haW5Gb3JtVmFsaWRhdG9yc0l0ZW1zJykgP1xuICAgICAgICAgIChpdGVtOiBbIHN0cmluZywgVCBdKSA9PiBpdGVtWyAwIF0gIT09IGtleSAmJiBpdGVtWyAwIF0gIT09ICdtYWluRm9ybVZhbGlkYXRvcnNJdGVtcycgOlxuICAgICAgICAgIChpdGVtOiBbIHN0cmluZywgVCBdKSA9PiBpdGVtWyAwIF0gIT09IGtleTtcbiAgICAgIGNvbnN0IG5ld01haW5WYWxpZGF0b3JzQXJyYXk6IFsgc3RyaW5nLCBUIF1bXSA9IG9sZE1hcC5oYXMoa2V5KSA/XG4gICAgICAgIG9sZE1hcC5oYXMoYCR7IGtleSB9SXRlbXNgKSA/XG4gICAgICAgICAgW1xuICAgICAgICAgICAgWyAnbWFpbkZvcm1WYWxpZGF0b3JzJywgb2xkTWFwLmdldChrZXkpISBdLFxuICAgICAgICAgICAgWyAnbWFpbkZvcm1WYWxpZGF0b3JzSXRlbXMnLCBvbGRNYXAuZ2V0KGAkeyBrZXkgfUl0ZW1zYCkhIF1cbiAgICAgICAgICBdIDpcbiAgICAgICAgICBbXG4gICAgICAgICAgICBbICdtYWluRm9ybVZhbGlkYXRvcnMnLCBvbGRNYXAuZ2V0KGtleSkhIF0sXG4gICAgICAgICAgXSA6XG4gICAgICAgIG9sZE1hcC5oYXMoYCR7IGtleSB9SXRlbXNgKSA/XG4gICAgICAgICAgW1xuICAgICAgICAgICAgWyAnbWFpbkZvcm1WYWxpZGF0b3JzSXRlbXMnLCBvbGRNYXAuZ2V0KGAkeyBrZXkgfUl0ZW1zYCkhIF1cbiAgICAgICAgICBdIDpcbiAgICAgICAgICBbXTtcbiAgICAgIHJldHVybiBuZXcgTWFwPHN0cmluZywgVD4oW1xuICAgICAgICAuLi5uZXdNYWluVmFsaWRhdG9yc0FycmF5LFxuICAgICAgICAuLi5BcnJheS5mcm9tKFxuICAgICAgICAgIG9sZE1hcC5lbnRyaWVzKClcbiAgICAgICAgKS5maWx0ZXIoZmlsdGVyUHJlZGljYXRlKS5tYXA8WyBzdHJpbmcsIFQgXT4oXG4gICAgICAgICAgKFsgZW50cnlLZXksIGVudHJ5VmFsdWUgXSkgPT4gWyBlbnRyeUtleS5zdGFydHNXaXRoKGAkeyBrZXkgfS5gKSA/IGVudHJ5S2V5LnJlcGxhY2UoYCR7IGtleSB9LmAsICcnKSA6IGVudHJ5S2V5LCBlbnRyeVZhbHVlIF1cbiAgICAgICAgKVxuICAgICAgXSk7XG4gICAgfTtcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1ha2VGb3JtPFQ+KFxuICBzb3VyY2U6IFQsXG4gIGtleXNWYWxpZGF0b3I/OiBNYXA8c3RyaW5nLCBWYWxpZGF0b3JGbltdIHwgbnVsbD4sXG4gIGFzeW5jS2V5c1ZhbGlkYXRvcj86IE1hcDxzdHJpbmcsIEFzeW5jVmFsaWRhdG9yRm5bXSB8IG51bGw+LFxuKTogU2NhbkZvcm1UeXBlPFQ+IHtcbiAgY29uc3QgZm9ybSA9ICEhc291cmNlICYmICh0eXBlb2Ygc291cmNlID09PSAnb2JqZWN0JyB8fCB0eXBlb2Ygc291cmNlID09PSAnZnVuY3Rpb24nKSA/XG4gICAgc291cmNlIGluc3RhbmNlb2YgQXJyYXk8QXJyYXlFbGVtZW50PFQ+PiA/XG4gICAgICBuZXcgRm9ybUFycmF5KFxuICAgICAgICBzb3VyY2UubWFwKFxuICAgICAgICAgIChpdGVtOiBBcnJheUVsZW1lbnQ8VD4pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW1Gb3JtID0gbWFrZUZvcm0oXG4gICAgICAgICAgICAgIGl0ZW0sXG4gICAgICAgICAgICAgIG1ha2VOZXdNYWluRm9ybVZhbGlkYXRvcnNNYXAoJ21haW5Gb3JtVmFsaWRhdG9yc0l0ZW1zJywga2V5c1ZhbGlkYXRvciksXG4gICAgICAgICAgICAgIG1ha2VOZXdNYWluRm9ybVZhbGlkYXRvcnNNYXAoJ21haW5Gb3JtVmFsaWRhdG9yc0l0ZW1zJywgYXN5bmNLZXlzVmFsaWRhdG9yKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIHJldHVybiBpdGVtRm9ybTtcbiAgICAgICAgICB9KSxcbiAgICAgICAgZ2V0VmFsaWRhdG9yc09yTnVsbCgnbWFpbkZvcm1WYWxpZGF0b3JzJywga2V5c1ZhbGlkYXRvciwgdHJ1ZSksXG4gICAgICAgIGdldFZhbGlkYXRvcnNPck51bGwoJ21haW5Gb3JtVmFsaWRhdG9ycycsIGFzeW5jS2V5c1ZhbGlkYXRvciwgZmFsc2UpXG4gICAgICApIDpcbiAgICAgIG1ha2VGb3JtR3JvdXA8VD4oc291cmNlLCAnbWFpbkZvcm1WYWxpZGF0b3JzJywga2V5c1ZhbGlkYXRvciwgYXN5bmNLZXlzVmFsaWRhdG9yKSA6XG4gICAgbmV3IEZvcm1Db250cm9sPFQgfCBudWxsPihcbiAgICAgICEhc291cmNlICYmIHR5cGVvZiBzb3VyY2UgPT0gJ3N0cmluZycgJiYgKHNvdXJjZS5pbmNsdWRlcygnMDAwMS0wMS0wMScpIHx8IHNvdXJjZS5pbmNsdWRlcygnMTk3MC0wMS0wMScpKSA/IG51bGwgOiBzb3VyY2VcbiAgICAgICxcbiAgICAgIGdldFZhbGlkYXRvcnNPck51bGwoJ21haW5Gb3JtVmFsaWRhdG9ycycsIGtleXNWYWxpZGF0b3IsIGZhbHNlKSxcbiAgICAgIGdldFZhbGlkYXRvcnNPck51bGwoJ21haW5Gb3JtVmFsaWRhdG9ycycsIGFzeW5jS2V5c1ZhbGlkYXRvciwgZmFsc2UpXG4gICAgKTtcbiAgcmV0dXJuIDxTY2FuRm9ybVR5cGU8VD4+IGZvcm07XG59O1xuXG5mdW5jdGlvbiBsaWZ0RXJyb3JzKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsIHtcbiAgaWYgKGNvbnRyb2wgaW5zdGFuY2VvZiBGb3JtQ29udHJvbCkge1xuICAgIHJldHVybiBudWxsO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGFsbENvbnRyb2xzID0gY29udHJvbCBpbnN0YW5jZW9mIEZvcm1Hcm91cCA/XG4gICAgICBPYmplY3QudmFsdWVzKGNvbnRyb2wuY29udHJvbHMpIDpcbiAgICAgIGNvbnRyb2wgaW5zdGFuY2VvZiBGb3JtQXJyYXkgP1xuICAgICAgICBjb250cm9sLmNvbnRyb2xzIDpcbiAgICAgICAgW107XG4gICAgY29uc3QgaW52YWxpZENvbnRyb2xzID0gYWxsQ29udHJvbHMuZmlsdGVyKGNvbnRyb2wgPT4gY29udHJvbC5zdGF0dXMgPT09ICdJTlZBTElEJyk7XG4gICAgcmV0dXJuIGludmFsaWRDb250cm9scy5sZW5ndGggPT09IDAgPyBudWxsIDogaW52YWxpZENvbnRyb2xzLnJlZHVjZShcbiAgICAgIChhY2N1bXVsYXRvciwgY3VycmVudCkgPT4ge1xuICAgICAgICBpZiAoY3VycmVudC5lcnJvcnMpIHtcbiAgICAgICAgICBhZGRWYWxpZGF0aW9uRXJyb3JzKGN1cnJlbnQuZXJyb3JzLCBhY2N1bXVsYXRvcik7XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBhY2N1bXVsYXRvcjtcbiAgICAgIH0sIDxWYWxpZGF0aW9uRXJyb3JzPiB7fVxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxpZnRWYWxpZGF0aW9uRXJyb3JzKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsIHtcbiAgY29uc3QgYWxsQ29udHJvbHMgPSBjb250cm9sIGluc3RhbmNlb2YgRm9ybUdyb3VwID9cbiAgICBPYmplY3QudmFsdWVzKGNvbnRyb2wuY29udHJvbHMpIDpcbiAgICBjb250cm9sIGluc3RhbmNlb2YgRm9ybUFycmF5ID9cbiAgICAgIGNvbnRyb2wuY29udHJvbHMgOlxuICAgICAgW107XG4gIGNvbnN0IGludmFsaWRDb250cm9scyA9IGFsbENvbnRyb2xzLmZpbHRlcihjb250cm9sID0+IGNvbnRyb2wuc3RhdHVzID09PSAnSU5WQUxJRCcpO1xuICBjb25zdCBlcnJvcnM6IFZhbGlkYXRpb25FcnJvcnMgPSBpbnZhbGlkQ29udHJvbHMubGVuZ3RoID09PSAwID8ge30gOiBpbnZhbGlkQ29udHJvbHMucmVkdWNlKFxuICAgIChhY2N1bXVsYXRvciwgY3VycmVudCkgPT4ge1xuICAgICAgaWYgKGN1cnJlbnQuZXJyb3JzKSB7XG4gICAgICAgIGFkZFZhbGlkYXRpb25FcnJvcnMoY3VycmVudC5lcnJvcnMsIGFjY3VtdWxhdG9yKTtcbiAgICAgIH07XG4gICAgICBjb25zdCBpbm5lckVycm9ycyA9IGxpZnRWYWxpZGF0aW9uRXJyb3JzKGN1cnJlbnQpO1xuICAgICAgaWYgKGlubmVyRXJyb3JzKSB7XG4gICAgICAgIGFkZFZhbGlkYXRpb25FcnJvcnMoaW5uZXJFcnJvcnMsIGFjY3VtdWxhdG9yKTtcbiAgICAgIH07XG4gICAgICByZXR1cm4gYWNjdW11bGF0b3I7XG4gICAgfSwgPFZhbGlkYXRpb25FcnJvcnM+IHt9XG4gICk7XG4gIHJldHVybiBPYmplY3QudmFsdWVzKGVycm9ycykubGVuZ3RoID09PSAwID8gbnVsbCA6IGVycm9ycztcbn07XG5cbmZ1bmN0aW9uIGFkZFZhbGlkYXRpb25FcnJvcnMoYWRkaXRpb25FcnJvcnM6IFZhbGlkYXRpb25FcnJvcnMsIGN1cnJlbnRFcnJvcnM6IFZhbGlkYXRpb25FcnJvcnMpIHtcbiAgT2JqZWN0LmVudHJpZXMoYWRkaXRpb25FcnJvcnMpLmZvckVhY2goXG4gICAgZW50cnkgPT4gY3VycmVudEVycm9yc1sgZW50cnlbIDAgXSBdID0gZW50cnlbIDEgXVxuICApO1xufSJdfQ==