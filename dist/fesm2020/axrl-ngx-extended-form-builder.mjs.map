{"version":3,"file":"axrl-ngx-extended-form-builder.mjs","sources":["../../projects/ngx-extended-form-builder/src/lib/ngx-extended-form-builder.ts","../../projects/ngx-extended-form-builder/src/public-api.ts","../../projects/ngx-extended-form-builder/src/axrl-ngx-extended-form-builder.ts"],"sourcesContent":["import { FormGroup, FormArray, FormControl } from \"@angular/forms\";\nimport type { ValidatorFn, ValidationErrors, AbstractControl, AsyncValidatorFn, AbstractControlOptions } from \"@angular/forms\";\nimport { Observable } from \"rxjs\";\n\ninterface ExtendedControlOptions extends AbstractControlOptions {\n  disabled?: boolean,\n};\n\nfunction getValidatorsOrNull(key: string, keysValidator?: Map<string, AsyncValidatorFn[] | null>, internal?: boolean): AsyncValidatorFn[] | null\nfunction getValidatorsOrNull(key: string, keysValidator?: Map<string, ValidatorFn[] | ExtendedControlOptions | null>, internal?: boolean): ValidatorFn[] | ExtendedControlOptions | null\nfunction getValidatorsOrNull(key: string, keysValidator?: Map<string, ValidatorFn[] | AsyncValidatorFn[] | ExtendedControlOptions | null>, internal: boolean = false): ValidatorFn[] | ExtendedControlOptions | AsyncValidatorFn[] | null | undefined {\n  return keysValidator?.has(key) && !internal ?\n    keysValidator.get(key) :\n    null\n}\n\nfunction makeFormGroup(\n  source: any,\n  keysValidator?: Map<string, ValidatorFn[] | ExtendedControlOptions | null>,\n  asyncKeysValidator?: Map<string, AsyncValidatorFn[] | null>,\n  internal: boolean = false\n): FormGroup {\n  return source instanceof FormGroup ? source : Object.entries(source).reduce(\n    (accumulator: FormGroup, entry: [string, unknown]) => {\n      const key = entry[0];\n      const value = entry[1];\n      if (!(value instanceof Observable)) {\n        accumulator.addControl(\n          key,\n          !!value && typeof value == 'object' && !(value instanceof Date) ?\n            value instanceof FormControl || value instanceof FormGroup || value instanceof FormArray ?\n              value :\n              makeForm(value, keysValidator, asyncKeysValidator, true) :\n            new FormControl(\n              {\n                disabled: keysValidator?.has(key) && 'disabled' in keysValidator.get(key)! ? (<ExtendedControlOptions>keysValidator.get(key)).disabled : false,\n                value: !!value && typeof value == 'string' && (value.includes('0001-01-01') || value.includes('1970-01-01')) ? null : value\n              },\n              getValidatorsOrNull(key, keysValidator),\n              getValidatorsOrNull(key, asyncKeysValidator)\n            )\n        );\n      };\n      return accumulator;\n    }, new FormGroup({},\n      getValidatorsOrNull('mainFormValidators', keysValidator, internal),\n      getValidatorsOrNull('mainFormValidators', asyncKeysValidator, internal)\n    )\n  );\n}\n\nexport function makeForm<T extends unknown, R extends (T extends Array<any> ? FormArray : T extends string | number | boolean | symbol ? FormControl : FormGroup)>(\n  source: T,\n  keysValidator?: Map<string, ValidatorFn[] | ExtendedControlOptions | null>,\n  asyncKeysValidator?: Map<string, AsyncValidatorFn[] | null>,\n  internal: boolean = false\n): R {\n  const form = !!source && (typeof source === 'object' || typeof source === 'function') ?\n    source instanceof Array ?\n      new FormArray(\n        source.map(\n          item => {\n            const itemForm = makeForm(item, keysValidator, asyncKeysValidator, true);\n            return itemForm;\n          }),\n        getValidatorsOrNull('mainFormValidators', keysValidator, internal),\n        getValidatorsOrNull('mainFormValidators', asyncKeysValidator, internal)\n      ) :\n      makeFormGroup(source, keysValidator, asyncKeysValidator, internal) :\n    new FormControl({\n      disabled: keysValidator?.has('mainFormValidators') && 'disabled' in (keysValidator.get('mainFormValidators')!) ?\n        (<ExtendedControlOptions>keysValidator.get('mainFormValidators')).disabled :\n        false,\n      value: source\n    },\n      getValidatorsOrNull('mainFormValidators', keysValidator, internal),\n      getValidatorsOrNull('mainFormValidators', asyncKeysValidator, internal)\n    );\n  return <R>form;\n};\n\nexport function liftValidationErrors(control: AbstractControl): ValidationErrors | null {\n  const allControls = control instanceof FormGroup ?\n    Object.values(control.controls) :\n    control instanceof FormArray ?\n      control.controls :\n      [];\n  const invalidControls = allControls.filter(control => control.status === 'INVALID');\n  const errors: ValidationErrors = invalidControls.length === 0 ? {} : invalidControls.reduce(\n    (accumulator, current) => {\n      if (current.errors) {\n        addValidationErrors(current.errors, accumulator);\n\n      };\n      const innerErrors = liftValidationErrors(current);\n      if (innerErrors) {\n        addValidationErrors(innerErrors, accumulator);\n      };\n      return accumulator;\n    }, <ValidationErrors>{}\n  );\n  return Object.values(errors).length === 0 ? null : errors;\n};\n\nfunction addValidationErrors(additionErrors: ValidationErrors, currentErrors: ValidationErrors) {\n  Object.entries(additionErrors).forEach(\n    entry => currentErrors[entry[0]] = entry[1]\n  );\n}","/*\n * Public API Surface of ngx-extended-form-builder\n */\n\nexport * from './lib/ngx-extended-form-builder';","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}